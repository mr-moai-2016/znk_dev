<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta http-equiv="Content-Script-Type" content="text/javascript">
	<meta http-equiv="Content-Style-Type" content="text/css">
	<link href="/msty.css" rel="stylesheet" type="text/css">
</head>
<body>
<a name=TopBar></a>
<p><b><img src="/imgs/here_landmark.png"> Moai2.0ドキュメント</b></p>

<a class=MstyElemLink        href="/">トップページ</a> &nbsp;
<a class=MstyNowSelectedLink href="/moai2.0/index.html">Moai2.0ドキュメント</a> &nbsp;
<a class=MstyElemLink        href="/moai1.1/index.html">Moai1.1ドキュメント</a> &nbsp;
<br> <br>
<a class=MstyElemLink        href="/moai2.0/install.html">インストールガイド</a> &nbsp;
<a class=MstyElemLink        href="/moai2.0/moai_reference.html">Moai本体</a> &nbsp;
<a class=MstyElemLink        href="/moai2.0/easter_reference.html">Easter</a> &nbsp;
<a class=MstyElemLink        href="/moai2.0/virtual_users.html">VirtualUSERS</a> &nbsp;
<a class=MstyElemLink        href="/moai2.0/customboy_reference.html">CustomBoy</a> &nbsp;
<a class=MstyNowSelectedLink href="/moai2.0/how_to_compile.html">HowToコンパイル</a> &nbsp;
<a class=MstyElemLink        href="/moai2.0/moai_cgi_developers.html">Moai CGI Developers</a> &nbsp;
<br> <br>

<div class=MstyComment>
<u><b>記事担当者</b></u> : Mr.Moai ＆ 全角<br> 
<br>
<u><b>最終更新日</b></u> : 2018/03/30<br>
<br>
</div>
<br>

<a name=AtFirst></a>
<u><b>はじめに</b></u>
<ul>
	<font >
		この記事では、Moaiのソースコードから実行バイナリ(exeファイル等)を作る手順について、<br>
		全くの初心者でもできるように丁寧に説明する.<br>
		この作業を「コンパイル」、これを行うためのツールを「コンパイラ」と呼ぶ.<br>
	</font><br>
</ul><br>


<a name=Index></a>
<u><b>目次</b></u>
<ul>
	<li><b><a class=MstyElemLink href=#WhyWeCompile >なぜソースコードからコンパイルするのか？</a></b></li>
	<li><b><a class=MstyElemLink href=#get_source_code>Moaiのソースコードの入手方法</a></b></li>
	<li><b><a class=MstyElemLink href=#windows_next >Windowsな方へ、はじめてのコンパイル</a></b></li>
	<li><b><a class=MstyElemLink href=#get_mingw    >MinGWの入手およびインストール方法</a></b></li>
	<li><b><a class=MstyElemLink href=#compile_by_mingw >WindowsでMinGWを使ってコンパイルする</a></b></li>
	<li><b><a class=MstyElemLink href=#compile_by_vc    >WindowsでVCを使ってコンパイルする</a></b></li>
	<li><b><a class=MstyElemLink href=#compile_on_linux >Linuxを使ってコンパイルする</a></b></li>
	<li><b><a class=MstyElemLink href=#compile_on_cygwin>Cygwinでコンパイルする</a></b></li>
	<li><b><a class=MstyElemLink href=#compile_on_msys>  MSYSを使ってコンパイルする</a></b></li>
	<li><b><a class=MstyElemLink href=#compile_on_others_windows>WindowsでBCC5.5(Borland C++ Compiler 5.5)またはDMC(Digital Mars C/C++)を使ってコンパイルする</a></b></li>
	<li><b><a class=MstyElemLink href=#compile_on_android>Android版をコンパイルする</a></b></li>
	<li><b><a class=MstyElemLink href=#about_macos>MacOSについて</a></b></li>
</ul><br>


<a name=WhyWeCompile></a>
<u><b>なぜソースコードからコンパイルして使うのか？</b></u>
<ul>
	<font >
		Moaiはオープンソースなツールであり、ソースコードを公開してあるが、<br>
		プログラマではない一般ユーザでもすぐに使えるように<br>
		Windows版とLinux版とAndroid版の実行バイナリも提供してある.<br>
		それなのになぜソースコードからコンパイルして使うのか？<br>
		<br>
		勿論、提供されている実行バイナリをそのまま使っていただいてよい.<br>
		多くの方は普通そうされることだろう.<br>
		そのような方についてはこの記事は不要である.<br>
		<br>
		しかし、中にはこのバイナリが<b>安全であるという確証</b>がなければ安心して使えないという方もおられよう.<br>
		残念ながら「いくらこれは安全です」と作者である我々が言ったところで、ほとんど何の確証にもならない.<br>
		おかげさまで我々が今まで開発してきたツールのことを皆様は大分よく知っていて、<br>
		そのような心配をなさる方も最近は見られなくなってはきたのだが、<br>
		そうではない方にとっては、これに関する唯一確実な方法はソースコードを見て納得してもらう他ない. <br>
		<br>
		とはいえ、我々プログラマでさえオープンソースのツールを使うとき、<br>
		そのコードの隅々まで読んでから使うなど稀なことである.<br>
		ましてやプログラマでもない方にこれをせよというのは酷というものである.<br>
		<br>
		ではどうすればよいか？<br>
		ソースコードが公開されている事実だけでよしとして、それ以上は気にしないというのも一つの考え方である.<br>
		一方、その内容を一応検査してから使いたいという慎重派な方は、あなたにプログラミングに詳しい知り合いがいるなら、<br>
		このソースコードをざっくりとチェックしてもらうのもよい.<br>
		そんな知り合いはいない方はプログラミングを扱う掲示板などでこのツールのソースコードのありか(GithubのURL)を記すなどして<br>
		意見を聞き、あなたなりの納得を得るのもよいかもしれない.<br>
		<br>
		さらに潔癖な方は、付属するソースコードをコンパイルしてそれを使用することを勧める.<br> 
		機械的な作業なので言うほど難しくはない(…と我々は思うのだが…).<br>
		勿論、我々が提供している実行バイナリは、このソースコードからコンパイルしたものに他ならないのだが、<br>
		例えばあなたがそのことを疑って、本当にそうであるという確証が欲しいと思ったとする.<br>
		そのためには、あなた自らがソースコードをコンパイルし、出来上がった実行バイナリを使ってもらうしかない.<br>
		<br>
		というわけで、この記事では主にMinGWを例にコンパイラの入手方法、インストール/設定方法、<br>
		実行方法に至るまで、全くの初心者でもわかるようこれでもかというくらい丁寧にその手順を書いたつもりである.
	</font><br>
</ul><br>


<a name=get_source_code></a>
<u><b>
Moaiのソースコードの入手方法
</b></u><br>
<br>
<div class=MstyIndent>
	現在の最新版Verはzipファイルとなっており、以下より入手できる.<br>
	<br>
	<a href=https://github.com/mr-moai-2016/znk_project/releases/latest>https://github.com/mr-moai-2016/znk_project/releases/latest</a><br>
	<br>
	ソースコードはAssetsにあるSource code とあるzipファイルにアーカイブとしてまとめられているので、これをダウンロードしよう.<br>
	これはお使いのPCのどのディレクトリへダウンロードして展開してもらっても構わない.<br>
	<br>
	<b><a class=MstyElemLink href=#Index>目次に戻る</a></b><br>
</div><br>
<br>


<a name=windows_next></a>
<u><b>Windowsな方へ、はじめてのコンパイル</b></u>
<ul>
	<font >
		ソースコードからのコンパイルなどやったことがない、<br>
		あるいは何から手をつければよいかわからない、と言う方も多いことだろう.<br>
		<br>
		Windowsを使っている方ならば、まずはC言語のコンパイラをインストールする必要がある.<br>
		<b>MinGW</b>と呼ばれている最もメジャーなものの一つを使う.<br>
		もちろんフリーウェアである.<br>
		<br>
		<a href=#get_mingw>MinGWの入手方法</a>の項へと進もう.<br>
		既にMinGWをインストールしてある方はこれをスルーして<a href=#compile_by_mingw>WindowsでMinGWを使ってコンパイルする</a>を参照していただきたい.<br>
		<br>
		尚、MinGWではなくVC(Visual C++)を使いたいという方は<a href=#compile_by_vc>WindowsでVCを使ってコンパイルする</a>を参照していただきたい.<br>
		<div class=MstyComment>
		VCの入手とインストール方法についてはここでは解説しない. <br>
		(多分、こちらを選ばれる方は、ある程度わかっている方だと思うので)<br>
		Microsoftよりフリーで提供されているVCとして Visual Studio Express があり、通常はそれで十分である.<br>
		</div>
		<br>
	</font><br>
	<b><a class=MstyElemLink href=#Index>目次に戻る</a></b>
</ul><br>


<a name=get_mingw></a>
<u><b>MinGWの入手方法</b></u>
<ul>
	<font >
		MinGWはメジャーなC言語コンパイラであり、入手およびインストール方法が解説されたサイトは<br>
		ごまんとあるのだが、ここでも<b>私流に</b>説明しておく.<br>
		<br>
		まずダウンロードサイトである<a href=https://sourceforge.net/downloads/mingw target=_blank>https://sourceforge.net/downloads/mingw</a>へアクセスしよう.<br>
		<div class=MstyComment>
			MinGWの公式サイトは<a href=http://www.mingw.org target=_blank>http://www.mingw.org</a>なのであるが<br>
			MinGWは現在、ダウンロードするファイル群はすべてsourceforgeの方へ置かれてある.<br>
			公式サイトのDownloadsリンクから迂回しても結局上記と同じ場所に導かれる.<br>
		</div>
		<br>
		「Download Latest Version mingw-get-setup.exe」と書かれた一番目立つ緑のボタンがあると思うので、<br>
		それをクリックしよう.<br>
		mingw-get-setup.exe を促すダイアログが出るのでそれをダウンロードする.<br>
		たとえばC:\MinGWというフォルダを作ってその中に保存しておくとよいだろう.<br>
		(これのファイルサイズは85KBと極めて小さい).<br>
		<br>
		次にこの mingw-get-setup.exe を実行する.<br>
		このプログラムはMinGWのインストーラを自動でダウンロードするといういわば<br>
		<b>インストーラをインストールするインストーラ</b>である(わかりにくい言い回しだが).<br>
		<br>
		さて、これを実行したらいよいよインストールのスタートである.<br>
		次の手順で行う.<br>
		<br>
		<ol>
			<li>多分最初に<b>アホな</b>Windowsが「セキュリティの警告」を表示してくるかもしれないが<br>
			<b>MinGWにその種の問題があろうはずもない</b>ので、構わず「実行」する.<br>
			</li>
			<br>
			<li>「MinGW Installation Manager Setup Tool」ウィンドウが表示されるので「Install」を押す.
			</li>
			<br>
			<li>次の画面でインストール先を指定できる. <br>
			デフォルトでは C:\MinGWとなっているが「Change」でこれを変えることもできる.<br>
			(その場合は以下の説明でC:\MinGWとなっている部分をそのフォルダで読み替えて欲しい).<br>
			最終的に180MB程度必要であるので、万一余裕がなければ他のドライブに変えるなどすること.<br>
			その他特に弄る必要はないのでこの指定を終えたら「Continue」を押す.<br>
			</li>
			<br>
			<li>するとC:\MinGW配下へファイル群が自動でダウンロードされる.<br>
			ここでダウンロードされるのはMinGW本体ではなくそのインストーラであり、<br>
			合計サイズにしておよそ2MBほどである.<br>
			100%と表示されたらダウンロードが終わったということである.<br>
			「Continue」を押して次へ進もう.<br>
			ここでうっかり間違って「Quit」を押すとウィンドウが閉じてしまうが…<br>
			<br>
			<b>C:\MinGW\bin\mingw-get.exeを実行すれば続きが表示されます</b>のでご安心を！<br>
			<br>
			この C:\MinGW\bin\mingw-get.exe こそがMinGWの本当のインストーラであり、<br>
			Installation Managerと呼ばれるものである.<br>
			</li>
			<br>
			<li>「MinGW Installation Manager」と書かれたウィンドウが表示されるので<br>
			ここからインストールしたい項目を選ぶ.<br>
			<br>
			全部選んでいたらとんでもない分量になるし、その必要も全くない.<br>
			ここでは<b>mingw32-base</b> と <b>mingw32-g++</b>だけを選べば十分だ.<br>
			(これだけでも合計180MB程度となり、実のところ結構な分量にはなる).<br>
			まず左側のペインにおいて「Basic Setup」を選んだ状態にし、<br>
			右側のペインで<b>mingw32-base</b>とある行の四角形のところをクリックする(あるいは右クリックでもよい).<br>
			このときプルダウンメニューが表示されるので「Mark for Installation」を選ぶ.<br>
			四角形のところに<b>オレンジ色の矢印マーク</b>が表示されれば選択された状態になったことを意味する.<br>
			<b>mingw32-g++</b>についても同様にして選択状態にしておこう.<br>
			<br>
			繰り返すがこれら以外はいらない. 必要最小限こそ我々のモットーである.<br>
			しかし将来その他が必要になることもあるかもしれないし…これだけで本当に大丈夫なのか？<br>
			と心配症な方は…<br>
			<br>
			<b>C:\MinGW\bin\mingw-get.exeを実行すれば後からでも追加インストールできます</b>のでご安心を！<br>
			<br>
			この C:\MinGW\bin\mingw-get.exe こそがMinGWの本当のインストーラであり、<br>
			Installation Managerと呼ばれるものであるッ！(大事なことなのでもう一度言いました）.<br>
			</li>
			<br>
			<li>いよいよ実際のパッケージ本体をダウンロードおよびインストールする.<br>
			一番左上にある「Installation」メニューを開き、「Apply Changes」を選ぶ.<br>
			「Schedule of Pending Actions」というウィンドウが現れるので「Apply」ボタンを押せば<br>
			実際にパッケージ群がずらーっとダウンロードおよびインストールされる.<br>
			<br>
			パッケージは勿論圧縮されてあるのでダウンロードは大して時間は掛からない.<br>
			ネットワークが特別混雑していないなら、筆者の貧弱な回線でも３分ほどで終る分量である.<br>
			またインストールといってもたいしたことをしているわけではなく、<br>
			C:\MinGW配下に必要な圧縮ファイルが解凍されるだけのことである.<br>
			上でも述べた通り、<b>mingw32-base</b> と <b>mingw32-g++</b> だけの場合、展開後は合計180MBほどになる.<br>
			</li>
			<br>
			<li>「Applying Scaduled Changes」というウィンドウが出て「All changes were applied successfully;」<br>
			などと書いてあれば成功である. 「Close」ボタンを押そう.<br>
			「MinGW Installation Manager」ウィンドウがまだ表示されていると思うがこれも右上のxボタンで閉じてよい.<br>
			</li>
		</ol>
		<br>
		非常に長かったが、これにて一件落着インストール完了である.<br>
		<a href=#compile_by_mingw>WindowsでMinGWを使ってコンパイルする</a>の項へと進もう.<br>
		<br>
		<div class=MstyComment>
			<u><b>補足1 : インストールされるものの内訳</b></u><br> <br>
			<b>mingw32-base</b>によりインストールされるのは以下である.<br>
			<br>
			<ul>
			<li>コンパイラgcc(Cのみ)</li>
			<li>リンカld</li>
			<li>ライブラリアンarおよびranlib</li>
			<li>makeコマンド(MinGWではmingw32-make.exeという名前である)</li>
			<li>デバッガgdb</li>
			<li>標準Cライブラリ(このとき動的リンクされるのはデフォルトではmsvcrt.dllである)</li>
			<li>MinGW用のWindowAPI SDK</li>
			<li>リソースコンパイラwindres(iconなどの設定に利用)</li>
			<li>プロファイラgprof</li>
			<li>その他若干のGNUユーティリティ</li>
			</ul>
			<br>
			<b>mingw32-g++</b>によりインストールされるのは以下である.<br>
			<br>
			<ul>
			<li>コンパイラgcc(C++用の内部コマンドg++)</li>
			<li>標準C++ライブラリ(libstdc++)</li>
			</ul>
			<br>
			よって、もしC++は全く扱わず、つまり本当にC言語だけしか扱わないのであれば、<br>
			実のところmingw32-baseだけで十分であり、つまりmingw32-g++は不要である.<br>
			(mingw32-baseだけの場合、30MBほど節約できて全部で合計150MB程度になる).<br>
			とはいえ、実際には C++ のコードも C と一緒くたになって巷に多く溢れかえっており、<br>
			これがコンパイルできないようでは困るので今回はこれも必須項目とした.<br>
			<br>
			尚、gccは様々な言語のフロントエンドになっており、C++をコンパイルする際も<br>
			コマンドとしてはgccコマンドを使えばよい(gccは拡張子によってCかC++かを自動的に判断する).<br>
			ではもしmingw32-g++をインストールしていない場合に、gccからC++のコードをコンパイルしようとすると<br>
			何が起こるのだろうか？<br>
			このときgccは以下のような非常にわかりにくいエラーメッセージを出すので注意が必要だ. <br>
			<br>
			<div class=MstyCode>
				gcc: error: CreateProcess: No such file or directory
			</div>
			<br>
			もしもこれが表示されたなら mingw32-g++をインストールし忘れているか、<br>
			失敗しているかしているのでもう一度mingw-get.exe(Installation Manager)を起動して<br>
			これを再インストールしよう.<br>
		</div>
		<br>
		<div class=MstyComment>
			<u><b>補足2 : アンインストール、移動、バックアップ、インストール失敗時の対処方法</b></u><br>
			<br>
			<b>mingw32-base</b> および <b>mingw32-g++</b> はクリーンかつハンディである.<br>
			これのインストールにおいてはレジストリなどの書き込みなどは行われない.<br>
			従ってアンインストールしたい場合は単にC:\MinGWをそのフォルダ毎削除すればよい.<br>
			<br>
			またインストールした後、そのフォルダを丸ごと別の場所へ移動してもかまわない.<br>
			例えばあなたの２台目のマシンにそのフォルダ毎コピーするだけで、そのマシンでも使える.<br>
			つまり２台目のマシン上で再び上記の手順でインストールする必要はないということである<br>
			(してもよいけれども).<br>
			<br>
			そしてバックアップについても同様に行える. <br>
			例えばMinGWが用済みになってしばらく使う予定がないので今はPCから削除したいが、<br>
			今度また使うこともあるかもしれないなと思われるなら、MinGWフォルダ全体を一枚のCDに焼いておき、<br>
			次回必要になった時、CD内のそのフォルダをそのまま丸ごとPCへコピーすれば即座に復元できる.<br>
			<br>
			ダウンロードされたアーカイブは、C:\MinGW\var\cache\mingw-get\packages内に一時保存されているので、<br>
			気になるならそちらも確認されるとよい.<br>
			インストールが完全に終った後であれば、このフォルダ内のアーカイブファイルは削除してよい.<br>
			(拡張子がxz、lzmaとなっているものがそれに該当する).<br>
			<br>
			また万一、通信の過程でこれらのアーカイブが壊れているかダウンロードが不完全であった場合は<br>
			再ダウンロードが必要となるが、その場合もこのフォルダ内の該当アーカイブを手動で消す必要がある.<br>
			さらにその場合はデフォルトでお使いのブラウザのキャッシュも消去しておく必要がある<br>
			( mingw-get.exeはダウンロード時、お使いのブラウザの機能を内部で利用しているためである ).<br>
			<br>
		</div>
	</font><br>
	<b><a class=MstyElemLink href=#Index>目次に戻る</a></b>
</ul><br>


<a name=compile_by_mingw></a>
<u><b>WindowsでMinGWを使ってコンパイルする</b></u>
<ul>
	<font >
		まず環境変数<b>ZNK_MINGW32_DIR</b>にMinGW32がインストールされたトップディレクトリを正しく設定する.<br>
		次にsrcフォルダの直下にある<b>make_world.bat</b>を実行する.<br>
		<br>
		<div class=MstyComment>
			<img src=/imgs/auto_trigger_run_mingw.png width=100%><br>
		</div>
		<br>
		古き良き時代を彷彿とさせるコマンドラインベースでのメニュー選択UIが表示されるので、<br>
		「3. switch debug-mode」を何回か選んでDEBUG_MODEを「optimize」にし、<br>
		「4. switch mkfid」を何回か選んでMKF_IDを「mingw」にし、<br>
		「5. switch machine」を何回か選んでMACHINEを「x86」にし、<br>
		最後に「1. make install」を選ぶ.<br>
		<div class=MstyComment>
			ここで「選ぶ」というのは、一番先頭にある数字のキーを押せばよいです.<br>
			またはその項目までカーソルキーで移動してEnterキーを押してもよいです.<br>
		</div>
		<br>
		MinGWが適切にインストールされているならば、これですべてのコンパイルが自動で行われる.<br>
		それぞれのプロジェクトのフォルダ内にout_dirというフォルダが自動的に生成され、<br>
		その中に目的の実行バイナリが生成されているはずである.<br>
		<br>
		さらには、srcの一つ上にmoai-v2.0-win32ディレクトリが生成され、<br>
		コンパイルされた実行バイナリや設定ファイルなどの必要なものすべてが、<br>
		そのディレクトリへとインストールされているはずである.<br>
		<br>
		以上でMoaiのコンパイルとインストールは完了である.
		<br>
		<div class=MstyComment>
			Ver1.1.8以前にあった compile_by_mingw.bat と install_bin_for_win32.bat は<br>
			Ver2.0では廃止/削除されました.<br>
		</div>
	</font><br>
	<b><a class=MstyElemLink href=#Index>目次に戻る</a></b>
</ul><br>


<a name=compile_by_vc></a>
<u><b>WindowsでVCを使ってコンパイルする</b></u>
<ul>
	<font >
		既にVCはお使いのPCにインストールされていることを前提としよう.<br>
		Moai Ver2.0以降で導入された新しいビルドシステムでは、インストールされているVCはほとんどの場合自動的に認識される.<br>
		特に VC6.0以上VC14.0以下のx86環境向けなら自動的に認識する.<br>
		これ以外のVCの場合は認識しないかもしれない.<br>
		もしも認識しない場合は環境変数ZNK_VSCOMNTOOLSで明示的に指定しなければならない.<br>
		以下のNoteを参考にして欲しい.<br>
		<br>
		<div class=MstyComment>
			<u><b>Note</b></u><br>
			<br>
			この場合、%ZNK_VSCOMNTOOLS%に以下のbatファイルが存在するかどうかがチェックされ、<br>
			存在するならそれを実行することにより、必要な環境変数の設定が行われる.<br>
			<br>
			<ul>
				<li>vsvars32.bat</li>
				<li>vsvars64.bat</li>
				<li>vsvarsamd64.bat</li>
				<li>VsDevCmd.bat</li>
			</ul>
			<br>
			よってお使いのVCにおいて上記のbatファイルのあるフォルダ位置がわかれば、<br>
			ZNK_VSCOMNTOOLSにはそのフォルダのフルパスを指定すればよいことになる.<br>
			<br>
			さらに ZNK_VC_SETENV32_CMD と ZNK_VC_SETENV64_CMD という環境変数も用意されており、<br>
			これらには上記のbatファイルのフルパスを直接指定することもできる.<br>
			前者がx86向けコンパイル用の環境変数設定用batファイルのフルパスであり、<br>
			後者がx64向けコンパイル用の環境変数設定用batファイルのフルパスである.<br>
			これらの環境変数が明示的に指定されている場合は、ZNK_VSCOMNTOOLSよりも優先される.<br>
		</div>
		<br>
		では手順の説明に入ろう.<br>
		まずsrcフォルダの直下にある<b>make_world.bat</b>を実行する.<br>
		<br>
		<div class=MstyComment>
			<img src=/imgs/auto_trigger_run_vc.png width=100%><br>
		</div>
		<br>
		古き良き時代を彷彿とさせるコマンドラインベースでのメニュー選択UIが表示されるので、<br>
		「3. switch debug-mode」を何回か選んでDEBUG_MODEを「optimize」にし、<br>
		「4. switch mkfid」を何回か選んでMKF_IDを「vc」にし、<br>
		「5. switch machine」を何回か選んでMACHINEを「x86」あるいは「x64」にし、<br>
		最後に「1. make install」を選ぶ.<br>
		<div class=MstyComment>
			ここで「選ぶ」というのは、一番先頭にある数字のキーを押せばよいです.<br>
			またはその項目までカーソルキーで移動してEnterキーを押してもよいです.<br>
		</div>
		<br>
		MinGWが適切にインストールされているならば、これですべてのコンパイルが自動で行われる.<br>
		それぞれのプロジェクトのフォルダ内にout_dirというフォルダが自動的に生成され、<br>
		その中に目的の実行バイナリが生成されているはずである.<br>
		MACHINEで「x64」を選んだ場合は64bit版バイナリが生成される.<br>
		<br>
		さらには、srcの一つ上にmoai-v2.0-win32(あるいはmoai-v2.0-win64)ディレクトリが生成され、<br>
		コンパイルされた実行バイナリや設定ファイルなどの必要なものすべてが、<br>
		そのディレクトリへとインストールされているはずである.<br>
		<br>
		以上でMoaiのコンパイルとインストールは完了である.
		<br>
		<div class=MstyComment>
			Ver1.1.8以前にあった compile_by_mingw.bat と install_bin_for_win32.bat は<br>
			Ver2.0では廃止/削除されました.<br>
		</div>
		<br>
		<div class=MstyComment>
			<u><b>参考：VCのインストールをどのように認識しているのか？</b></u><br>
			<br>
			Moaiのコンパイルはすべてコマンドラインベースで行うことができる.<br>
			(IDEを起動する必要は一切ない)<br>
			またそれらを一括で実行するためのルールが記述されたMakefileも用意されており、<br>
			nmakeコマンドを使うことでこのMakefileの内容を実行できる.<br>
			<br>
			その際、いくつかの必要な環境変数をあらかじめ設定しておく必要があるが、<br>
			通常は我々がこれを手動で全部設定する必要はなく、VCのインストールディレクトリ配下に<br>
			これらを自動設定するためのbatファイルが存在するのでそれを使う. <br>
			<br>
			これはVCのバージョンによって場所と名前と中身が異なるが例えばVC7.0以上VC14.0以下のx86環境向けなら<br>
			vsvars32.bat という名前になっている.<br>
			この環境のVCがインストールされた場合は VS??COMNTOOLS (??にはバージョン番号が入る)という形式の<br>
			環境変数が設定される. これを利用してvsvars32.batの場所を特定することができる.<br>
			<br>
		</div>
		<br>
	</font><br>
	<b><a class=MstyElemLink href=#Index>目次に戻る</a></b>
</ul><br>


<a name=compile_on_linux></a>
<u><b>Linuxでコンパイルする</b></u>
<ul>
	<font >
		これを使われているような方は既にある程度わかっておられる方だとは思う.<br>
		<br>
		以下のコマンドが実行できるように必要に応じてこれらをインストールする.<br>
		<br>
		<div class=MstyComment>
			gcc<br>
			g++<br>
			ld<br>
			ar<br>
			ranlib<br>
			make<br>
		</div>
		<br>
		これらはどれも C/C++での開発において最低限必要となる基本コマンドばかりである.<br>
		個別にインストールしてもよいが、Development系のカテゴリにある基本パッケージをインストールすれば<br>
		まずすべて自動でインストールされると思う（例えばArch Linuxなら pacman で base-devel をインストールする). <br>
		具体的なインストール方法はそれぞれのLinuxディストリビューションによって千差万別なのでここでは記載しない. <br>
		ディストリビューションによっては最初からインストールされている可能性も高い.<br>
		<br>
		その上でターミナル(xterm, urxvtなどなんでもよいが)を開き、srcディレクトリ内の以下のシェルスクリプトを実行する.<br>
		<br>
		<div class=MstyComment>
			<div class=MstyCode>
				sh ./make_world.sh install
			</div>
		</div>
		<br>
		上記の基本コマンドが適切にインストールされているならば、これですべてのコンパイルが自動で行われる.<br>
		それぞれのプロジェクトのディレクトリ内にout_dirというディレクトリが自動的に生成され、<br>
		その中に目的の実行バイナリが生成されているはずである.<br>
		尚、環境変数MACHINEに「x86」または「x64」を明示的に設定して上記を実行した場合は、<br>
		それぞれ32bit版または64bit版バイナリが生成される.<br>
		この環境変数を指定していない場合は、uname -m コマンドの実行結果により<br>
		32bit版か64bit版かが自動的に決定される..<br>
		<br>
		さらには、srcの一つ上にmoai-v2.0-linux32(あるいはmoai-v2.0-linux64)ディレクトリが生成され、<br>
		コンパイルされた実行バイナリや設定ファイルなどの必要なものすべてが、<br>
		そのディレクトリへとインストールされているはずである.<br>
		<br>
		以上でMoaiのコンパイルとインストールは完了である.
		<br>
		<div class=MstyComment>
			Ver1.1.8以前にあった compile_on_linux.bat と install_bin_for_linux.bat は<br>
			Ver2.0では廃止/削除されました.<br>
		</div>
		<br>
		srcディレクトリを出てmoai-v2.0-linux64ディレクトリへと移動し、moaiを起動しよう.<br>
		以下のようなメッセージが表示されればmoaiは無事起動している.<br>
		<br>
		<div class=MstyComment>
			Moai : config load OK.<br>
			Moai : target load OK.<br>
			Moai : analysis load OK.<br>
			Moai : Filter Loading [filters/….myf]<br>
			Moai : Plugin Loading [plugins/….so]<br>
			…<br>
			Moai : acceptable_host=[LOOPBACK]<br>
			Moai : blocking_mode=[0]<br>
			Moai : AutoGet PrivateIP=[192.168.…].<br>
			Moai : Listen port 8124...<br>
			<br>
			Moai : ObserveR : 1-th sock events by select.<br>
		</div>
		<br>
		この状態でブラウザでhttp://127.0.0.1:8124にアクセスしよう.<br>
		EasterやVirtualUSERSも使えるはずである.<br>
		<br>
	</font><br>
	<b><a class=MstyElemLink href=#Index>目次に戻る</a></b>
</ul><br>


<a name=compile_on_cygwin></a>
<u><b>Cygwinでコンパイルする(Moai Ver1.1.8向け)</b></u>
<ul>
	<font >
		既にCygwinを愛用されており、MinGWなどの競合開発環境をわざわざインストールしたくない方もおられると思う.<br>
		この項目はそのような方向けである.<br>
		<br>
		<div class=MstyComment>
			<u><b>注意</b></u><br>
			<br>
			Cygwinではややこしいことに、この上で動作するMinGWをインストールすることもできる.<br>
			その場合gccオプションとして -mno-cygwinを使うことで(Cygwin版gccではなく)MinGW版gccを呼び出すこともできる.<br>
			ここではムダにややこしくしたくないため、そのような使い方については対応しない.<br>
			つまり作成を目指す実行バイナリは純粋なWindows APIをベースとしたプログラムではなく、<br>
			cygwin1.dllなどのCygwin固有のdllをベースとしたUNIXエミュレーションで動作するプログラムとする.<br>
			(Cygwin本来の趣旨は後者であろう).<br>
			<br>
			MinGWでWindows純正のプログラムとしてコンパイルしたい場合は、<br>
			上記<a href=#compile_by_mingw>WindowsでMinGWを使ってコンパイルする</a>を参照していただきたい.<br>
			あるいはMSYSを使うという手もある. 下記<a href=#compile_on_msys>MSYSを使ってコンパイルする</a>を参照していただきたい.<br>
			どうしてもCygwin上でMinGWを使いたい方は MSYS の状況に一番近いことから考えて、Makefile_msys.makを<br>
			各自修正するのが一番簡単であると思う.<br>
			生成されるdll名の微調整やコマンドラインオプション -mno-cygwin を追加する程度の変更で済むとは思う.<br>
			<br>
		</div>
		<br>
		Cygwinインストーラ(setup-x86.exe)では、gcc-core, gcc-g++, make, binutilsをインストールしておく.<br>
		( binutilsとは、ld, ar, ranlib, asコマンドなどを含むパッケージである ).<br>
		これらはどれも C/C++での開発において最低限必要となる基本パッケージである.<br>
		setup-x86.exe においてこれらを個別にインストールしてもよいが、<br>
		Develカテゴリにこれらは全て含まれているので面倒ならこのカテゴリごと一括でインストールしてもよい.<br>
		<br>
		その上でCygwinターミナルを開き、srcディレクトリ内の以下のシェルスクリプトを実行する.<br>
		<br>
		<div class=MstyComment>
			<div class=MstyCode>
				sh ./make_world.sh install
			</div>
		</div>
		<br>
		上記の基本コマンドが適切にインストールされているならば、これですべてのコンパイルが自動で行われる.<br>
		それぞれのプロジェクトのディレクトリ内にout_dirというディレクトリが自動的に生成され、<br>
		その中に目的の実行バイナリが生成されているはずである.<br>
		このシェルスクリプトにより、Makefile_cygwin.mak の存在する全ディレクトリへ自動的に移動しつつ<br>
		make -f Makefile_cygwin.mak が実行される.<br>
		この時点でコンパイル後のバイナリは、各ディレクトリ内のout_dirに格納されている.
		<br>
		尚、Cygwinの場合、出来上がるdllの名前にはcygプリフィックスをつけている.<br>
		これば別に必須というわけではないのだが、Cygwin用のdllはVCやMinGWにより生成する普通のdllとは一部異なるため、<br>
		区別するためにこのようにしてある. <br>
		<br>
		以上でコンパイルおよびインストールは完了である.<br>
		<br>
		<div class=MstyComment>
			Ver1.1.8以前にあった compile_on_cygwin.sh と install_bin_for_cygwin.sh は<br>
			Ver2.0では廃止/削除されました.<br>
		</div>
		<br>
		srcディレクトリを出てmoai-v2.0-cygwin32ディレクトリへと移動し、moaiを起動しよう.<br>
		以降はLinux版と同じである.<br>
	</font><br>
	<b><a class=MstyElemLink href=#Index>目次に戻る</a></b>
</ul><br>


<a name=compile_on_msys></a>
<u><b>MSYSを使ってコンパイルする</b></u>
<ul>
	<font >
		ここではMSYS1.0を使用したMinGWによるコンパイル手順を示す.<br>
		(申し訳ないがMSYS2.0の場合は<s>面倒くせーので</s>解説しない).<br>
		<br>
		MSYS1.0をまだインストールされていない方は、まずは<a href=#get_mingw>MinGWの入手方法</a>を先にご一読願いたい.<br>
		既にそちらをご一読されている方はもうお分かりだと思うが、<br>
		<br>
		<b>C:\MinGW\bin\mingw-get.exeを実行すれば後からでも追加インストールできます</b>のでご安心を<br>
		…いただけるのだった.<br>
		<br>
		この C:\MinGW\bin\mingw-get.exe こそがMinGWの本当のインストーラであり、<br>
		Installation Managerと呼ばれるものである<br>
		…のだった.<br>
		<br>
		実はこのInstallation ManagerからMSYS1.0も追加インストールできる.<br>
		というわけで、まずはmingw-get.exeを実行しよう.<br>
		その後の具体的な手順を以下に示す.<br>
		<br>
		<ol>
			<li>「MinGW Installation Manager」と書かれたウィンドウが表示されるので<br>
			ここからインストールしたい項目を選ぶ.<br>
			<br>
			まず左側のペインにおいて「Basic Setup」を選んだ状態にし、<br>
			右側のペインで<b>msys-base</b>とある行の四角形のところをクリックする(あるいは右クリックでもよい).<br>
			このときプルダウンメニューが表示されるので「Mark for Installation」を選ぶ.<br>
			四角形のところに<b>オレンジ色の矢印マーク</b>が表示されれば選択された状態になったことを意味する.<br>
			</li>
			<br>
			<li>いよいよ実際のパッケージ本体をダウンロードおよびインストールする.<br>
			一番左上にある「Installation」メニューを開き、「Apply Changes」を選ぶ.<br>
			「Schedule of Pending Actions」というウィンドウが現れるので「Apply」ボタンを押せば<br>
			実際にパッケージ群がずらーっとダウンロードおよびインストールされる.<br>
			<br>
			パッケージは勿論圧縮されてあるのでダウンロードは大して時間は掛からない.<br>
			またインストールといってもたいしたことをしているわけではなく、<br>
			C:\MinGW配下に必要な圧縮ファイルが解凍されるだけのことである.<br>
			<b>msys-base</b> だけの場合、展開後は合計20MBほどになる.<br>
			</li>
			<br>
			<li>「Applying Scaduled Changes」というウィンドウが出て「All changes were applied successfully;」<br>
			などと書いてあれば成功である. 「Close」ボタンを押そう.<br>
			「MinGW Installation Manager」ウィンドウがまだ表示されていると思うがこれも右上のxボタンで閉じてよい.<br>
			</li>
			<br>
			<li>C:\MinGWフォルダを開いてみよう.<br>
			<b>msys\1.0</b>というフォルダが新しく出来ているはずであり、これがMSYSの本体である.<br>
			この中に入るとmsys.batというファイルがあるのがわかる.<br>
			これをクリックして実行するとMSYSのターミナルウィンドウが開く.<br>
			毎回このフォルダまで入ってこれをクリックするのが面倒なら、<br>
			デスクトップにこのmsys.batへのショートカットを作っておくのもよいだろう.<br>
			<br>
			プロンプトの部分に「/home/あなたのユーザ名」のような表示がなされているはずだ.<br>
			これがカレントディレクトリを示しているが、これは一体どこなのだろうか？<br>
			</li>
			<br>
			<li>そう！<b>我々が最初に打つべきコマンドは mount である</b>.<br>
			現在どのWindows上のどのフォルダが、MSYS内のどのディレクトリにマウントされているか？<br>
			mountコマンドを打つことでこれを確認できる.<br>
			では早速確認してみよう.<br>
			<br>
			<div class=MstyComment>
				<div class=MstyCode>
					$ mount<br>
					C:\MinGW\msys\1.0 on /usr   type user (binmode,noumount)<br>
					C:\MinGW\msys\1.0 on /      type user (binmode,noumount)<br>
					C:\MinGW\msys\1.0 on /mingw type user (binmode)<br>
					C:\Users\Zenkaku\AppData\Local\Temp on /tmp type user (binmode,noumount)<br>
					c: on /c type user (binmode,noumount)<br>
				</div>
			</div>
			<br>
			上記より、ルートディレクトリ(/)はC:\MinGW\msys\1.0であることがわかる.<br>
			つまりMSYS上で /home/Zenkaku となっていればその実体は C:\MinGW\msys\1.0\home\Zenkakuフォルダということだ.<br>
			</li>
			<br>
			<li>次にmakeコマンドが使えるかどうかを確認する.<br>
			<br>
			<div class=MstyComment>
				<div class=MstyCode>
					$ make<br>
					make: *** No targets specified and no makefile found.  Stop.<br>
				</div>
			</div>
			<br>
			無事上記のような表示になれば、MSYSはmakeコマンドを認識している.<br>
			whichコマンドを使えば、make.exeの実体は C:\MinGW\msys\1.0\bin\make.exeということもわかる.<br>
			<br>
			<div class=MstyComment>
				万一 sh: make command not found などと表示されたら、何らかの理由で<br>
				make.exe がきちんとインストールされていないということだ.<br>
				念のため、上記に戻って「MinGW Installation Manager」からmsys-baseをインストールしなおそう.<br>
				<br>
				また左ペインにおいて「All Packages」⇒「MSYS」⇒「MSYS Base System」を選ぶと<br>
				msys-make がインストールされているかどうかをピンポイントで確認することもできる.<br>
				万一これがインストール状態になっているにも関わらずこの症状が出るなら、<br>
				おそらくは C:\MinGW\var\cache\mingw-get\packages\make-3.81-3-msys-1.0.13-bin.tar.lzma が壊れている.<br>
				(あなたの環境ではこのファイル名は若干異なるかもしれない).<br>
				まずはこのファイルを削除し、さらにあなたが普段使っているブラウザのキャッシュを消した上で<br>
				再度インストールを試みた方がいいだろう.<br>
			</div>
			</li>
			<br>
			<li>次にgccコマンドが使えるかどうかを確認する.<br>
			<br>
			<div class=MstyComment>
				<div class=MstyCode>
					$ gcc<br>
					sh: gcc: command not found<br>
				</div>
			</div>
			<br>
			無事上記のような表示になれば…、いや無事ではない！<br>
			MSYSはgccコマンドを認識していないのだ！<br>
			なぜか？<br>
			<br>
			我々は既にMinGW本体はインストールしてある.<br>
			gcc.exe の実体はC:\MinGW\bin配下にあるはずである.<br>
			この位置をMSYSに教えねばならない.<br>
			そのためにはMinGWのトップフォルダC:\MinGW をMSYSでの /mingw ディレクトリとして<br>
			マウントさせなければならないのである.<br>
			<br>
			C:\MinGW\msys\1.0\etc\fstab.confをテキストエディタで開こう.<br>
			もしもこれが存在しなければ、まず同フォルダ内のfstab.sample を fstab.confと言う名前でコピーしてそれを開こう.<br>
			このファイルでは # で始まる行は単なる説明文なので無視してよく、それ以外の行に注目しよう.<br>
			次のような行があるのではなかろうか？<br>
			<br>
			<div class=MstyComment>
				<div class=MstyCode>
					c:/mingw	/mingw<br>
				</div>
			</div>
			<br>
			二つ値があるが、左側がWindowsでの実体をあらわすパス、右側がそのMSYS上でのディレクトリを示す.<br>
			今、/mingwに相当する実体のパスをきちんと設定したいのであるから、我々が修正すべきはこの左側である.<br>
			もしもあなたのMinGWがインストールされたフォルダがC:\MinGWではないなら、<br>
			上記の左側(c:/mingwの部分)をあなたのMinGWがインストールされたフォルダのパスへ<br>
			正しく書き換える必要がある.<br>
			書き換えたらこのファイルを上書き保存しよう.<br>
			</li>
			<br>
			<li>再度gccコマンドが使えるかどうかを確認する.<br>
			<br>
			<div class=MstyComment>
				<div class=MstyCode>
					$ gcc<br>
					sh: gcc: command not found<br>
				</div>
			</div>
			<br>
			無事に sh: gcc: command not found と表示されたであろうか？<br>
			そう！まだダメである！<br>
			なぜか？<br>
			<br>
			実は我々はまだ最後の仕上げを一つ忘れているのである.<br>
			そう！<b>我々が最後に打つべきコマンドは mount である</b>.<br>
			上記の /etc/fstab.confに書かれた内容を反映させるには、次のようにしてmountコマンドを実行する必要がある.<br>
			<br>
			<div class=MstyComment>
				<div class=MstyCode>
					$ mount /mingw<br>
				</div>
			</div>
			<br>
			万一 '/mingw' is already mounted などと表示されたら、一旦/mingwをアンマウントしてから、<br>
			再度マウントする必要がある. 次のようになるだろう.<br>
			<br>
			<div class=MstyComment>
				<div class=MstyCode>
					$ umount /mingw<br>
					$ mount /mingw<br>
				</div>
			</div>
			<br>
			将来、MinGWフォルダの位置を移動するなどして /etc/fstab.confの内容を書き直したら<br>
			このアンマウント/マウントを再度実行する必要があるので注意しよう.<br>
			</li>
		</ol>
		<br>
		非常に長かったが、これにて一件落着インストール完了である.<br>
		<br>
		あとはMSYSターミナルを開き、srcディレクトリ内の以下のシェルスクリプトを実行する.<br>
		<br>
		<div class=MstyComment>
			<div class=MstyCode>
				sh ./make_world.sh install
			</div>
		</div>
		<br>
		上記の基本コマンドが適切にインストールされているならば、これですべてのコンパイルが自動で行われる.<br>
		それぞれのプロジェクトのディレクトリ内にout_dirというディレクトリが自動的に生成され、<br>
		その中に目的の実行バイナリが生成されているはずである.<br>
		このシェルスクリプトにより、Makefile_msys.mak の存在する全ディレクトリへ自動的に移動しつつ<br>
		make -f Makefile_msys.mak が実行される.<br>
		この時点でコンパイル後のバイナリは、各ディレクトリ内のout_dirに格納されている.
		<br>
		以上でコンパイルおよびインストールは完了である.<br>
		<br>
		<div class=MstyComment>
			MSYSを使ったMoaiのコンパイルに正式に対応しているのは Moai Ver2.0以降である.<br>
			Moai Ver1.1.8以前ではMSYSでのコンパイルには対応していない.<br>
			(Ver1.1.8では、MSYS用 のMakefile( Makefile_msys.mak )が標準では用意されていない.<br>
			このようなMakefileをあなたが自分で作れば、多分大丈夫だろうけども.)<br>
		</div>
		<br>
		moai-v2.0-win32 フォルダへと移動し、moaiを起動しよう.<br>
		以降はMinGW版と同じである.<br>
	</font><br>
	<b><a class=MstyElemLink href=#Index>目次に戻る</a></b>
</ul><br>

<a name=compile_on_others_windows></a>
<u><b>WindowsでBCC5.5(Borland C++ Compiler 5.5)またはDMC(Digital Mars C/C++)を使ってコンパイルする</b></u>
<ul>
	<font >
		あなたが(MinGWでもVCでもCygwinでもなく)あえてこれらを選ぶというなら、もはや我々は何も言うまい.<br>
		我々もそれに答えるべく、そのヒントをここで示そう.<br>
		<br>
		これら用のmakefileはかさばるので同梱していないが、実のところソースコード自体は<br>
		これらでもコンパイルできるように移植性に一応配慮してある.<br>
		興味がある<b>奇特な方</b>は、以下を参考に各自makefileを作成して欲しい.<br>
		<br>
		<li><b>BCC5.5(Borland C++ Compiler 5.5)</b><br>
		objを作る場合の指定方法(コンパイラはbcc32となる)<br>
		<div class=MstyComment>
			<div class=MstyCode>
				bcc32 -w -RT -c -oYourFile.obj YouFile.c<br>
			</div>
		</div>
		<br>
		exeを作る場合の指定方法(リンカはilink32となる)<br>
		OBJSは、+記号で各objファイルを連結したものを指定するという変態仕様である.<br>
		<div class=MstyComment>
			<div class=MstyCode>
				ilink32 -w -Gn -C -Tpe -ap c0x32.obj $(OBJS) $(LFLAGS),YourApplication.exe,,import32.lib cw32mt.lib,,YourResource.res<br>
			</div>
		</div>
		<br>
		静的ライブラリ(lib)を作る場合の指定方法(ライブラリアンはtlibとなる)<br>
		オプション /P4096 はページサイズとなり、OMF形式ではこれを明示的に指定する必要がある.<br>
		<div class=MstyComment>
			<div class=MstyCode>
				tlib YourStaticLib.lib /P4096 $(OBJS)<br>
			</div>
		</div>
		<br>
		dllおよびそれに対応するインポートライブラリを作る場合の指定方法.<br>
		(インポートライブラリはimplibを使用してdllあるいはdefファイルから自動生成する.)<br>
		(尚、この方法は__stdcallには対応しない)<br>
		<div class=MstyComment>
			<div class=MstyCode>
				ilink32 -w -Gn -C -Tpd c0d32x.obj $(OBJS) $(LFLAGS),YourDLL.dll,,import32.lib cw32mt.lib,YourDLL.def<br>
				implib -f -a YourDLL.lib YourDLL.dll<br>
				( あるいは implib -f -a YourDLL.lib YourDLL.def )<br>
			</div>
		</div>
		</li>
		<br>
		<li><b>DMC(Digital Mars C/C++)</b><br> 
		我々が実際にテストしたのは最新バージョン(Ver8.57)のみである.<br>
		<br>
		objを作る場合の指定方法(コンパイラはdmcとなる)<br>
		<div class=MstyComment>
			<div class=MstyCode>
				dmc -HP99 -Bj -j0 -Ab -Ae -Ar -w6 -c -oYourFile.obj YouFile.c<br>
			</div>
		</div>
		<br>
		exeを作る場合の指定方法(リンカはlinkとなる)<br>
		<div class=MstyComment>
			<div class=MstyCode>
				link -EXET:NT $(OBJS),YourApplication.exe,,ws2_32.lib user32.lib kernel32.lib,,YourResource.res
			</div>
		</div>
		<br>
		静的ライブラリ(lib)を作る場合の指定方法(ライブラリアンはlibとなる)<br>
		オプション -p4096 はページサイズとなり、OMF形式ではこれを明示的に指定する必要がある.<br>
		<div class=MstyComment>
			<div class=MstyCode>
				lib -c -p4096 YourStaticLib.lib $(OBJS)
			</div>
		</div>
		<br>
		dllおよびそれに対応するインポートライブラリを作る場合の指定方法.<br>
		(インポートライブラリはimplibを使用してdllから自動生成する.)<br>
		<div class=MstyComment>
			<div class=MstyCode>
				link -EXET:NT $(OBJS),YourDLL.dll,,ws2_32.lib user32.lib kernel32.lib,YourDLL.def<br>
				implib /system YourDLL.lib YourDLL.dll<br>
			</div>
		</div>
		</li>
		<br>
	</font><br>
	<b><a class=MstyElemLink href=#Index>目次に戻る</a></b>
</ul><br>


<a name=compile_on_android></a>
<u><b>Android版をコンパイルする</b></u>
<ul>
	<font >
		Androidは基本的にLinuxであるが、PC Linuxとは大きく異なる部分もある.<br>
		そして通常、AndroidにおけるアプリはJava VMをベースとして(エントリポイントとして)提供される.<br>
		Java VMベースなアプリでは、グラフィカルなアイコンがホーム画面に表示され、<br>
		それをタップすることで起動する.<br>
		<br>
		しかしながら、今回コンパイルする Moai for Android はJava VMベースではなく<br>
		AndroidのLinux上で直接走るネイティブアプリとしてC言語で開発する.<br>
		この場合ホーム画面にMoai用の特別なアイコンが表示されることはない.<br>
		Moaiを起動するには、まず端末エミュレータを開き、cdコマンドにより<br>
		moai実行バイナリが存在するディレクトリ(moai-v2.0-android-armeabi)へと移動してから<br>
		moai実行バイナリを直接起動する形になる.<br>
		要するにLinux環境のターミナルなどでプログラムを起動するのと同じ要領で行う.<br>
		<br>
		さて、前置きが長くなったが、ネイティブアプリとしてC言語のソースコードをコンパイルするには<br>
		Android NDKを使う.<br>
		<div class=MstyComment>
			この記事では、執筆時点で配布されているr14を例にとる.<br>
			あなたが入手するAndroid NDK最新バージョンでは仕様が変わっている可能性があることをご了承願いたい)<br>
		</div>
		<br>
		Android NDKは <a href=https://developer.android.com/ndk/downloads/index.html target=_blank>http://developer.android.com/ndk/downloads/index.html</a>よりダウンロードできる.<br>
		また開発はAndroid上では行えないためPCが必要である.<br>
		つまりAndroid NDKは、あなたの開発用PCへダウンロードしこのPC上にて開発を行う.<br>
		<br>
		しかし Android NDKのファイルサイズはかなり大きいので注意してほしい.<br>
		ダウンロードするzipファイルは約750MB程度もあり、さらにこれを解凍展開するとなんと<b>3GB</b>ほどにもなる！<br>
		つまりこれらを単純に合計しただけでもディスクの空きが4GB程度必要となる.<br>
		<br>
		尚、<b>Android Studio および android-sdk は必要ない.</b>インストールさえも不要である.<br>
		同様に<b>JDK(Java Development Kit)やJREなども必要ない.</b><br>
		<br>
		Android NDKをダウンロードしたら、これをディスクへ解凍展開する.<br>
		無事解凍できただろうか？<br>
		なにせファイルサイズが馬鹿デカイため、解凍ツールでさえエラーなどが表示されるかもしれない.<br>
		念のため確認しよう.<br>
		<br>
		さて、いよいよAndroid NDKを利用したコンパイル作業に入る.<br>
		ここではWindows上でコンパイルする場合について述べる.<br>
		LinuxあるいはCygwin上で行う場合については後述の「ndk-buildコマンドを用いてコンパイルする方法」を参照して欲しい.<br>
		ただし、Moai Ver2.0ではこのndk-buildを用いたコンパイルは推奨しない.<br>
		<br>
		まず環境変数<b>ZNK_NDK_DIR</b>にAndroid NDKのトップディレクトリを正しく設定する.<br>
		次にsrcフォルダの直下にある<b>make_world.bat</b>を実行する.<br>
		<br>
		<div class=MstyComment>
			<img src=/imgs/auto_trigger_run_mingw.png width=100%><br>
		</div>
		<br>
		古き良き時代を彷彿とさせるコマンドラインベースでのメニュー選択UIが表示されるので、<br>
		「3. switch debug-mode」を何回か選んでDEBUG_MODEを「optimize」にし、<br>
		「4. switch mkfid」を何回か選んでMKF_IDを「android」にし、<br>
		「5. switch machine」を何回か選んでMACHINEを「armeabi」にし、<br>
		最後に「1. make install」を選ぶ.<br>
		<div class=MstyComment>
			ここで「選ぶ」というのは、一番先頭にある数字のキーを押せばよいです.<br>
			またはその項目までカーソルキーで移動してEnterキーを押してもよいです.<br>
		</div>
		<br>
		Android NDKが適切にインストールされているならば、これですべてのコンパイルが自動で行われる.<br>
		それぞれのプロジェクトのフォルダ内にout_dirというフォルダが自動的に生成され、<br>
		その中に目的の実行バイナリが生成されているはずである.<br>
		<br>
		さらには、srcの一つ上にmoai-v2.0-android-armeabiディレクトリが生成され、<br>
		コンパイルされた実行バイナリや設定ファイルなどの必要なものすべてが、<br>
		そのディレクトリへとインストールされているはずである.<br>
		<br>
		以上でMoaiのコンパイルとインストールは完了である.
		<br>
		<div class=MstyComment>
			Ver1.1.8以前にあった android_compile.sh android_install_bin.sh は<br>
			Ver2.0では廃止/削除されました.<br>
		</div>
		<br>
		<div class=MstyComment>
			<u><b>ndk-buildコマンドを用いてコンパイルする方法</b></u><br>
			<br>
			Moai で提供されている Makefile_android.mak は純粋にWindows上でコンパイルするためのものである.<br>
			即ち、このMakefile_android.mak は CygwinやLinux上においては使用できない.<br>
			これらの環境においては、<b>ndk-build</b> コマンドを使用する必要がある.<br>
			<b>ndk-build</b> コマンドは Android NDK が提供するコンパイル用スクリプトである.<br>
			<br>
			まずは環境変数 ZNK_NDK_DIR に Android NDK のトップディレクトリのパスをセットしよう.<br>
			例えば以下のような感じである.<br>
			<br>
			<div class=MstyComment>
				<div class=MstyCode>
					export NK_NDK_DIR=/cygdrive/c/android-ndk-r10e
				</div>
			</div>
			<br>
			ndk-build コマンドの実体は $ZNK_NDK_DIR 直下、あるいは $ZNK_NDK_DIR/build ディレクトリの下にある.<br>
			つまり以下のように環境変数PATHをセットすれば、ndk-buildが実行できるようになるはずである.<br>
			<br>
			<div class=MstyComment>
				<div class=MstyCode>
					export PATH=$PATH:$ZNK_NDK_DIR:$ZNK_NDK_DIR/build
				</div>
			</div>
			<br>
			各プロジェクトディレクトリに入ると mkf_android というディレクトリがあるので、<br>
			さらにこの中へ移動してから ndk-build コマンドを実行するとコンパイルが始まる.<br>
			例えばlibZnkなら、以下のようになる.<br>
			<br>
			<div class=MstyComment>
				<div class=MstyCode>
					cd libZnk/mkf_android<br>
					ndk-build<br>
				</div>
			</div>
			<br>
			mkf_androidの中で ndk-buildを実行すると、同ディレクトリに libs, obj ディレクトリが生成され、<br>
			コンパイルしたバイナリやライブラリなどがここに出力される.<br>
			ちなみに同ディレクトリ内のjniディレクトリには、ndk_-buildでコンパイルするためのMakefileが格納されてある.<br>
			<br>
			尚、この方法の場合、申し訳ないがインストール等を自動で行う方法を現時点では提供していない.<br>
			(この方法を現バージョンでは非推奨にしている理由の一つがそれである)<br>
			libsディレクトリ内に作成されたバイナリを手動で適切なインストール配置へコピーする必要がある.<br>
			(公式サイトにてAndroid版のバイナリを提供しているので、それのディレクトリ構成を参考にしてほしい)<br>
			<br>
			Moaiでは ndk-buildを使ったコンパイルのテストはあまり行っていないため、<br>
			NDKのバージョンによっては上記でもうまくいかないかもしれない.<br>
		</div>
		<br>
		<br>
		最後に出来上がった moai-v2.0-android-armeabi を実機に転送した上でそれを実行する.<br>
		これには色々方法があるが、とりあえずはmoai-v2.0-android-armeabiを一旦zipファイルに固めて適当なWebサイト上にアップし<br>
		実機からこれをダウンロードするというクソ回りくどい方法が<s>ここで説明するには</s>一番簡単だ.<br>
		まあどんな方法でもよいがとりあえずなんとかこれを実機へと転送して欲しい.<br>
		<br>
		<div class=MstyComment>
			<u><b>実行するにあたっての注意</b></u><br>
			<br>
			<ol>
			<li>ホームディレクトリ以外では書き込み権限および実行権限の関係で実行できないことがある.<br>
				よってまず「端末エミュレータ」を開き、cd コマンドよりホームディレクトリへ移動する.<br>
				(単にcdと入力してEnterを押せばよい).<br>
				<br>
				そしてmoai-v2.0-android-armeabi.zipをダウンロードなどした場合は、<br>
				Downloadディレクトリからホームディレクトリへこれをコピーしなければならない.<br>
				Downloadディレクトリはデフォルトのブラウザの場合、/storage/sdcard0/Download などに存在し、<br>
				その配下にダウンロードしたファイルも置かれている.<br>
				以下のように実行することでこれをホームディレクトリへコピーしよう.<br>
				<br>
				<div class=MstyComment>
					<div class=MstyCode>
						cp /storage/sdcard0/Download/moai-v2.0-android-armeabi.zip ~/
					</div>
				</div>
			</li>
			<br>
			<li>moai-v2.0-android-armeabi.zip をホームディレクトリへコピーしたら、以下を実行しこれを解凍しよう.<br>
				<br>
				<div class=MstyComment>
					<div class=MstyCode>
						unzip moai-v2.0-android-armeabi.zip
					</div>
				</div>
				<br>
				次に cd moai-v2.0-android-armeabi で実行バイナリのあるディレクトリ内へと移動し、<br>
				moai_for_android.sh を実行する. <br>
				<br>
				<div class=MstyComment>
					<div class=MstyCode>
						sh ./moai_for_android.sh
					</div>
				</div>
			</li>
			</ol>
			<br>
			うまくいけばこれでMoaiが起動するはずである.<br>
			上記「Linuxの場合」で説明したのと同様のメッセージが表示されれば成功である.<br>
		</div>
	</font><br>
	<b><a class=MstyElemLink href=#Index>目次に戻る</a></b>
</ul><br>


<a name=about_macos></a>
<u><b>MacOSについて</b></u>
<ul>
	<font >
		現状では未サポートである.<br>
		仮にコンパイルを試みるなら(手元にないので未確認であるが)Darwinを使うことになると思う.<br>
		これにgcc, makeコマンドなどLinuxと同様のツールが含まれており、<br>
		多分Makefile_linux.makを少し手直しすれば同様の方法でコンパイルできるはずである.<br>
		(ダイナミックリンクライブラリの拡張子はsoではなくdylibやtbdといったものになるようである.<br>
		その他リンカldのオプションもおそらくMacOS独自のものを指定しなければならないだろう)<br>
	</font><br>
	<b><a class=MstyElemLink href=#Index>目次に戻る</a></b>
</ul><br>


<u><b>リンク</b></u>
<ul>
	<li><a class=MstyElemLink href="#TopBar">一番上へ</a></li>
	<li><a class=MstyElemLink href="https://mr-moai-2016.github.io">Moaiドキュメント(オンライン)</a></li>
	<li><a class=MstyElemLink href="https://github.com/mr-moai-2016/znk_project">znk_project(github)</a></li>
</ul><br>

</body>
</html>
