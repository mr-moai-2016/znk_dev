<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta http-equiv="Content-Script-Type" content="text/javascript">
	<meta http-equiv="Content-Style-Type" content="text/css">
	<link href="/msty.css" rel="stylesheet" type="text/css">
</head>
<body>
<a name=TopBar></a>
<p><b><img src="/imgs/here_landmark.png"> Moai1.1ドキュメント</b></p>

<a class=MstyElemLink href="/">トップページ</a> &nbsp;
<a class=MstyElemLink href="/moai2.0/index.html">Moai2.0ドキュメント</a> &nbsp;
<a class=MstyNowSelectedLink href="/moai1.1/index.html">Moai1.1ドキュメント</a> &nbsp;
<br> <br>
<a class=MstyElemLink        href="/moai1.1/install.html">インストールガイド</a> &nbsp;
<a class=MstyElemLink        href="/moai1.1/index.html">Moaiの特徴</a> &nbsp;
<a class=MstyElemLink        href="/moai1.1/moai_reference.html">Moaiリファレンス</a> &nbsp;
<a class=MstyElemLink        href="/moai1.1/local_proxy.html">ローカルプロキシ</a> &nbsp;
<a class=MstyElemLink        href="/moai1.1/FAQ.html">FAQ</a> &nbsp;
<a class=MstyNowSelectedLink href="/moai1.1/how_to_compile.html">HowToコンパイル</a> &nbsp;
<a class=MstyElemLink        href="/moai1.1/hacking.html">ハッキング</a> &nbsp;
<br> <br>

<div class=MstyComment>
<u><b>記事担当者</b></u> : Mr.Moai ＆ 全角<br> 
<br>
<u><b>最終更新日</b></u> : 2018/03/29<br>
<br>
</div>
<br>

<a name=AtFirst></a>
<u><b>はじめに</b></u>
<ul>
	<font >
		この記事では、Moaiのソースコードから実行バイナリ(exeファイル等)を作る手順について、<br>
		全くの初心者でもできるように丁寧に説明する.<br>
		この作業を「コンパイル」、これを行うためのツールを「コンパイラ」と呼ぶ.<br>
	</font><br>
</ul><br>


<a name=Index></a>
<u><b>目次</b></u>
<ul>
	<li><b><a class=MstyElemLink href=#WhyWeCompile >なぜソースコードからコンパイルするのか？</a></b></li>
	<li><b><a class=MstyElemLink href=#windows_next >Windowsな方へ、はじめてのコンパイル</a></b></li>
	<li><b><a class=MstyElemLink href=#get_mingw    >MinGWの入手およびインストール方法</a></b></li>
	<li><b><a class=MstyElemLink href=#compile_by_mingw >WindowsでMinGWを使ってコンパイルする(Moai Ver1.1.8向け)</a></b></li>
	<li><b><a class=MstyElemLink href=#compile_by_vc    >WindowsでVCを使ってコンパイルする(Moai Ver1.1.8向け)</a></b></li>
	<li><b><a class=MstyElemLink href=#compile_on_linux >Linuxを使ってコンパイルする(Moai Ver1.1.8向け)</a></b></li>
	<li><b><a class=MstyElemLink href=#compile_on_cygwin>Cygwinでコンパイルする(Moai Ver1.1.8向け)</a></b></li>
	<li><b><a class=MstyElemLink href=#compile_on_msys>  MSYSを使ってコンパイルする(Moai Ver2.0以降)</a></b></li>
	<li><b><a class=MstyElemLink href=#compile_on_others_windows>WindowsでBCC5.5(Borland C++ Compiler 5.5)またはDMC(Digital Mars C/C++)を使ってコンパイルする</a></b></li>
	<li><b><a class=MstyElemLink href=#compile_on_android>Android版をコンパイルする(Moai Ver1.1.8向け)</a></b></li>
	<li><b><a class=MstyElemLink href=#about_macos>MacOSについて</a></b></li>
</ul><br>


<a name=WhyWeCompile></a>
<u><b>なぜソースコードからコンパイルして使うのか？</b></u>
<ul>
	<font >
		Moaiはオープンソースなツールであり、ソースコードを公開してあるが、<br>
		プログラマではない一般ユーザでもすぐに使えるように<br>
		Windows版とLinux版とAndroid版の実行バイナリも提供してある.<br>
		それなのになぜソースコードからコンパイルして使うのか？<br>
		<br>
		勿論、提供されている実行バイナリをそのまま使っていただいてよい.<br>
		多くの方は普通そうされることだろう.<br>
		そのような方についてはこの記事は不要である.<br>
		<br>
		しかし、中にはこのバイナリが<b>安全であるという確証</b>がなければ安心して使えないという方もおられよう.<br>
		残念ながら「いくらこれは安全です」と作者である我々が言ったところで、ほとんど何の確証にもならない.<br>
		おかげさまで我々が今まで開発してきたツールのことを皆様は大分よく知っていて、<br>
		そのような心配をなさる方も最近は見られなくなってはきたのだが、<br>
		そうではない方にとっては、これに関する唯一確実な方法はソースコードを見て納得してもらう他ない. <br>
		<br>
		とはいえ、我々プログラマでさえオープンソースのツールを使うとき、<br>
		そのコードの隅々まで読んでから使うなど稀なことである.<br>
		ましてやプログラマでもない方にこれをせよというのは酷というものである.<br>
		<br>
		ではどうすればよいか？<br>
		ソースコードが公開されている事実だけでよしとして、それ以上は気にしないというのも一つの考え方である.<br>
		一方、その内容を一応検査してから使いたいという慎重派な方は、あなたにプログラミングに詳しい知り合いがいるなら、<br>
		このソースコードをざっくりとチェックしてもらうのもよい.<br>
		そんな知り合いはいない方はプログラミングを扱う掲示板などでこのツールのソースコードのありか(GithubのURL)を記すなどして<br>
		意見を聞き、あなたなりの納得を得るのもよいかもしれない.<br>
		<br>
		さらに潔癖な方は、付属するソースコードをコンパイルしてそれを使用することを勧める.<br> 
		機械的な作業なので言うほど難しくはない(…と我々は思うのだが…).<br>
		勿論、我々が提供している実行バイナリは、このソースコードからコンパイルしたものに他ならないのだが、<br>
		例えばあなたがそのことを疑って、本当にそうであるという確証が欲しいと思ったとする.<br>
		そのためには、あなた自らがソースコードをコンパイルし、出来上がった実行バイナリを使ってもらうしかない.<br>
		<br>
		というわけで、この記事では主にMinGWを例にコンパイラの入手方法、インストール/設定方法、<br>
		実行方法に至るまで、全くの初心者でもわかるようこれでもかというくらい丁寧にその手順を書いたつもりである.
	</font><br>
</ul><br>



<a name=windows_next></a>
<u><b>Windowsな方へ、はじめてのコンパイル</b></u>
<ul>
	<font >
		ソースコードからのコンパイルなどやったことがない、<br>
		あるいは何から手をつければよいかわからない、と言う方も多いことだろう.<br>
		<br>
		Windowsを使っている方ならば、まずはC言語のコンパイラをインストールする必要がある.<br>
		<b>MinGW</b>と呼ばれている最もメジャーなものの一つを使う.<br>
		もちろんフリーウェアである.<br>
		<br>
		<a href=#get_mingw>MinGWの入手方法</a>の項へと進もう.<br>
		既にMinGWをインストールしてある方はこれをスルーして<a href=#compile_by_mingw>WindowsでMinGWを使ってコンパイルする</a>を参照していただきたい.<br>
		<br>
		尚、MinGWではなくVC(Visual C++)を使いたいという方は<a href=#compile_by_vc>WindowsでVCを使ってコンパイルする</a>を参照していただきたい.<br>
		<div class=MstyComment>
		VCの入手とインストール方法についてはここでは解説しない. <br>
		(多分、こちらを選ばれる方は、ある程度わかっている方だと思うので)<br>
		Microsoftよりフリーで提供されているVCとして Visual Studio Express があり、通常はそれで十分である.<br>
		</div>
		<br>
	</font><br>
	<b><a class=MstyElemLink href=#Index>目次に戻る</a></b>
</ul><br>


<a name=get_mingw></a>
<u><b>MinGWの入手方法</b></u>
<ul>
	<font >
		MinGWはメジャーなC言語コンパイラであり、入手およびインストール方法が解説されたサイトは<br>
		ごまんとあるのだが、ここでも<b>私流に</b>説明しておく.<br>
		<br>
		まずダウンロードサイトである<a href=https://sourceforge.net/downloads/mingw target=_blank>https://sourceforge.net/downloads/mingw</a>へアクセスしよう.<br>
		<div class=MstyComment>
			MinGWの公式サイトは<a href=http://www.mingw.org target=_blank>http://www.mingw.org</a>なのであるが<br>
			MinGWは現在、ダウンロードするファイル群はすべてsourceforgeの方へ置かれてある.<br>
			公式サイトのDownloadsリンクから迂回しても結局上記と同じ場所に導かれる.<br>
		</div>
		<br>
		「Download Latest Version mingw-get-setup.exe」と書かれた一番目立つ緑のボタンがあると思うので、<br>
		それをクリックしよう.<br>
		mingw-get-setup.exe を促すダイアログが出るのでそれをダウンロードする.<br>
		たとえばC:\MinGWというフォルダを作ってその中に保存しておくとよいだろう.<br>
		(これのファイルサイズは85KBと極めて小さい).<br>
		<br>
		次にこの mingw-get-setup.exe を実行する.<br>
		このプログラムはMinGWのインストーラを自動でダウンロードするといういわば<br>
		<b>インストーラをインストールするインストーラ</b>である(わかりにくい言い回しだが).<br>
		<br>
		さて、これを実行したらいよいよインストールのスタートである.<br>
		次の手順で行う.<br>
		<br>
		<ol>
			<li>多分最初に<b>アホな</b>Windowsが「セキュリティの警告」を表示してくるかもしれないが<br>
			<b>MinGWにその種の問題があろうはずもない</b>ので、構わず「実行」する.<br>
			</li>
			<br>
			<li>「MinGW Installation Manager Setup Tool」ウィンドウが表示されるので「Install」を押す.
			</li>
			<br>
			<li>次の画面でインストール先を指定できる. <br>
			デフォルトでは C:\MinGWとなっているが「Change」でこれを変えることもできる.<br>
			(その場合は以下の説明でC:\MinGWとなっている部分をそのフォルダで読み替えて欲しい).<br>
			最終的に180MB程度必要であるので、万一余裕がなければ他のドライブに変えるなどすること.<br>
			その他特に弄る必要はないのでこの指定を終えたら「Continue」を押す.<br>
			</li>
			<br>
			<li>するとC:\MinGW配下へファイル群が自動でダウンロードされる.<br>
			ここでダウンロードされるのはMinGW本体ではなくそのインストーラであり、<br>
			合計サイズにしておよそ2MBほどである.<br>
			100%と表示されたらダウンロードが終わったということである.<br>
			「Continue」を押して次へ進もう.<br>
			ここでうっかり間違って「Quit」を押すとウィンドウが閉じてしまうが…<br>
			<br>
			<b>C:\MinGW\bin\mingw-get.exeを実行すれば続きが表示されます</b>のでご安心を！<br>
			<br>
			この C:\MinGW\bin\mingw-get.exe こそがMinGWの本当のインストーラであり、<br>
			Installation Managerと呼ばれるものである.<br>
			</li>
			<br>
			<li>「MinGW Installation Manager」と書かれたウィンドウが表示されるので<br>
			ここからインストールしたい項目を選ぶ.<br>
			<br>
			全部選んでいたらとんでもない分量になるし、その必要も全くない.<br>
			ここでは<b>mingw32-base</b> と <b>mingw32-g++</b>だけを選べば十分だ.<br>
			(これだけでも合計180MB程度となり、実のところ結構な分量にはなる).<br>
			まず左側のペインにおいて「Basic Setup」を選んだ状態にし、<br>
			右側のペインで<b>mingw32-base</b>とある行の四角形のところをクリックする(あるいは右クリックでもよい).<br>
			このときプルダウンメニューが表示されるので「Mark for Installation」を選ぶ.<br>
			四角形のところに<b>オレンジ色の矢印マーク</b>が表示されれば選択された状態になったことを意味する.<br>
			<b>mingw32-g++</b>についても同様にして選択状態にしておこう.<br>
			<br>
			繰り返すがこれら以外はいらない. 必要最小限こそ我々のモットーである.<br>
			しかし将来その他が必要になることもあるかもしれないし…これだけで本当に大丈夫なのか？<br>
			と心配症な方は…<br>
			<br>
			<b>C:\MinGW\bin\mingw-get.exeを実行すれば後からでも追加インストールできます</b>のでご安心を！<br>
			<br>
			この C:\MinGW\bin\mingw-get.exe こそがMinGWの本当のインストーラであり、<br>
			Installation Managerと呼ばれるものであるッ！(大事なことなのでもう一度言いました）.<br>
			</li>
			<br>
			<li>いよいよ実際のパッケージ本体をダウンロードおよびインストールする.<br>
			一番左上にある「Installation」メニューを開き、「Apply Changes」を選ぶ.<br>
			「Schedule of Pending Actions」というウィンドウが現れるので「Apply」ボタンを押せば<br>
			実際にパッケージ群がずらーっとダウンロードおよびインストールされる.<br>
			<br>
			パッケージは勿論圧縮されてあるのでダウンロードは大して時間は掛からない.<br>
			ネットワークが特別混雑していないなら、筆者の貧弱な回線でも３分ほどで終る分量である.<br>
			またインストールといってもたいしたことをしているわけではなく、<br>
			C:\MinGW配下に必要な圧縮ファイルが解凍されるだけのことである.<br>
			上でも述べた通り、<b>mingw32-base</b> と <b>mingw32-g++</b> だけの場合、展開後は合計180MBほどになる.<br>
			</li>
			<br>
			<li>「Applying Scaduled Changes」というウィンドウが出て「All changes were applied successfully;」<br>
			などと書いてあれば成功である. 「Close」ボタンを押そう.<br>
			「MinGW Installation Manager」ウィンドウがまだ表示されていると思うがこれも右上のxボタンで閉じてよい.<br>
			</li>
		</ol>
		<br>
		非常に長かったが、これにて一件落着インストール完了である.<br>
		<a href=#compile_by_mingw>WindowsでMinGWを使ってコンパイルする</a>の項へと進もう.<br>
		<br>
		<div class=MstyComment>
			<u><b>補足1 : インストールされるものの内訳</b></u><br> <br>
			<b>mingw32-base</b>によりインストールされるのは以下である.<br>
			<br>
			<ul>
			<li>コンパイラgcc(Cのみ)</li>
			<li>リンカld</li>
			<li>ライブラリアンarおよびranlib</li>
			<li>makeコマンド(MinGWではmingw32-make.exeという名前である)</li>
			<li>デバッガgdb</li>
			<li>標準Cライブラリ(このとき動的リンクされるのはデフォルトではmsvcrt.dllである)</li>
			<li>MinGW用のWindowAPI SDK</li>
			<li>リソースコンパイラwindres(iconなどの設定に利用)</li>
			<li>プロファイラgprof</li>
			<li>その他若干のGNUユーティリティ</li>
			</ul>
			<br>
			<b>mingw32-g++</b>によりインストールされるのは以下である.<br>
			<br>
			<ul>
			<li>コンパイラgcc(C++用の内部コマンドg++)</li>
			<li>標準C++ライブラリ(libstdc++)</li>
			</ul>
			<br>
			よって、もしC++は全く扱わず、つまり本当にC言語だけしか扱わないのであれば、<br>
			実のところmingw32-baseだけで十分であり、つまりmingw32-g++は不要である.<br>
			(mingw32-baseだけの場合、30MBほど節約できて全部で合計150MB程度になる).<br>
			とはいえ、実際には C++ のコードも C と一緒くたになって巷に多く溢れかえっており、<br>
			これがコンパイルできないようでは困るので今回はこれも必須項目とした.<br>
			<br>
			尚、gccは様々な言語のフロントエンドになっており、C++をコンパイルする際も<br>
			コマンドとしてはgccコマンドを使えばよい(gccは拡張子によってCかC++かを自動的に判断する).<br>
			ではもしmingw32-g++をインストールしていない場合に、gccからC++のコードをコンパイルしようとすると<br>
			何が起こるのだろうか？<br>
			このときgccは以下のような非常にわかりにくいエラーメッセージを出すので注意が必要だ. <br>
			<br>
			<div class=MstyCode>
				gcc: error: CreateProcess: No such file or directory
			</div>
			<br>
			もしもこれが表示されたなら mingw32-g++をインストールし忘れているか、<br>
			失敗しているかしているのでもう一度mingw-get.exe(Installation Manager)を起動して<br>
			これを再インストールしよう.<br>
		</div>
		<br>
		<div class=MstyComment>
			<u><b>補足2 : アンインストール、移動、バックアップ、インストール失敗時の対処方法</b></u><br>
			<br>
			<b>mingw32-base</b> および <b>mingw32-g++</b> はクリーンかつハンディである.<br>
			これのインストールにおいてはレジストリなどの書き込みなどは行われない.<br>
			従ってアンインストールしたい場合は単にC:\MinGWをそのフォルダ毎削除すればよい.<br>
			<br>
			またインストールした後、そのフォルダを丸ごと別の場所へ移動してもかまわない.<br>
			例えばあなたの２台目のマシンにそのフォルダ毎コピーするだけで、そのマシンでも使える.<br>
			つまり２台目のマシン上で再び上記の手順でインストールする必要はないということである<br>
			(してもよいけれども).<br>
			<br>
			そしてバックアップについても同様に行える. <br>
			例えばMinGWが用済みになってしばらく使う予定がないので今はPCから削除したいが、<br>
			今度また使うこともあるかもしれないなと思われるなら、MinGWフォルダ全体を一枚のCDに焼いておき、<br>
			次回必要になった時、CD内のそのフォルダをそのまま丸ごとPCへコピーすれば即座に復元できる.<br>
			<br>
			ダウンロードされたアーカイブは、C:\MinGW\var\cache\mingw-get\packages内に一時保存されているので、<br>
			気になるならそちらも確認されるとよい.<br>
			インストールが完全に終った後であれば、このフォルダ内のアーカイブファイルは削除してよい.<br>
			(拡張子がxz、lzmaとなっているものがそれに該当する).<br>
			<br>
			また万一、通信の過程でこれらのアーカイブが壊れているかダウンロードが不完全であった場合は<br>
			再ダウンロードが必要となるが、その場合もこのフォルダ内の該当アーカイブを手動で消す必要がある.<br>
			さらにその場合はデフォルトでお使いのブラウザのキャッシュも消去しておく必要がある<br>
			( mingw-get.exeはダウンロード時、お使いのブラウザの機能を内部で利用しているためである ).<br>
			<br>
		</div>
	</font><br>
	<b><a class=MstyElemLink href=#Index>目次に戻る</a></b>
</ul><br>


<a name=compile_by_mingw></a>
<u><b>WindowsでMinGWを使ってコンパイルする(Moai Ver1.1.8向け)</b></u>
<ul>
	<font >
		src/bat_utils フォルダにsetenv_mingw.bat というファイルがある.<br>
		これをテキストエディタ(メモ帳など)で開き、以下の行を必要に応じて適切に修正する.<br>
		<br>
		<div class=MstyComment>
			set ZNK_MINGW_DIR=C:\MinGW<br>
		</div>
		<br>
		C:\MinGWの部分をあなたがインストールしたMinGWのフォルダのパスに修正するだけである.<br>
		(ズバリ C:\MinGW にインストールされている場合は修正の必要はない)<br>
		修正し終ったらこれを上書き保存しよう.<br>
		<br>
		さて、いよいよコンパイルを実行する時が来た！<br>
		srcフォルダにある<b>compile_by_mingw.bat をクリックして実行しよう</b>.<br>
		<br>
		MinGWが適切にインストールされているならば、これですべてのコンパイルが自動で行われる.<br>
		それぞれのプロジェクトのフォルダ内にout_dirというフォルダが自動的に生成され、<br>
		その中に目的の実行バイナリが生成されているはずである.<br>
		即ち、以下のものである.<br>
		<br>
		<ul>
			<li>src/libZnk/out_dir/Znk-1.1.dll</li>
			<li>src/moai/out_dir/moai.exe</li>
			<li>src/http_decorator/out_dir/http_decorator.exe</li>
			<li>src/plugin_futaba/out_dir/futaba.dll</li>
			<li>src/plugin_2ch/out_dir/2ch.dll</li>
		</ul>
		<br>
		後はこれらを(srcフォルダとは別の)bin_for_win32フォルダ配下へ適切にコピーするだけなのだが<br>
		コピー先はそれぞれ以下のようになる(pluginだけはpluginsというフォルダに入れる必要がある).<br>
		<br>
		<ul>
			<li>bin_for_win32/Znk-1.1.dll</li>
			<li>bin_for_win32/moai.exe</li>
			<li>bin_for_win32/http_decorator.exe</li>
			<li>bin_for_win32/plugins/futaba.dll</li>
			<li>bin_for_win32/plugins/2ch.dll</li>
		</ul>
		<br>
		さらにbin_for_win32が全くの空の状態なら、実行バイナリ以外にその他の設定ファイルもコピーしておく必要がある.<br>
		面倒なら srcフォルダにある <b>install_bin_for_win32.bat</b> を実行すればこのコピーまで自動的に<br>
		行ってくれるので活用するとよい.<br>
		<br>
		<b>ハイ！初心者の方はここまでッ！</b>
		非常に長かったですがお疲れ様ッした！<br>
		これ以降は中級者の方向けの内容となっております.<br>
		<br>
		<div class=MstyComment>
			<u><b>参考：compile_by_mingw.bat が内部で行っていること</b></u><br>
			<br>
			ここではcompile_by_mingw.bat を使わずに設定する方法を述べる.<br>
			換言すればcompile_by_mingw.bat が内部で行っていることの解説でもある.<br>
			<br>
			Moaiのコンパイルはすべてコマンドラインベースで行うことができる.<br>
			またそれらを一括で実行するためのルールが記述されたMakefileも用意されており、<br>
			mingw32-makeコマンドを使うことでこのMakefileの内容を実行できる.<br>
			<br>
			では具体的な手順を説明しよう.<br>
			まず<a href=/common/complementary.html#command_prompt target=_blank>コマンドプロンプト</a>を開き、mingw32-make.exe が実行できるように環境変数を整える.<br>
			整えなければならない環境変数は、PATHである.<br>
			Makefile内で使われるすべてのMinGW系コマンドは以下であり、<br>
			つまり環境変数PATHには、これらが存在するフォルダのパスを追加的にセットする形になる.<br>
			<br>
			<div class=MstyComment>
				gcc.exe<br>
				ld.exe<br>
				ar.exe<br>
				ranlib.exe<br>
				mingw32-make.exe<br>
			</div>
			<br>
			例えば これらが C:\MinGW\bin内にあるならば、コマンドプロンプト上で以下のように入力し、<br>
			Enterキーを押す.<br>
			<br>
			<div class=MstyComment>
				<div class=MstyCode>
					set PATH=C:\MinGW\bin;%PATH%<br>
				</div>
			</div>
			<br>
			最後に ; 区切りで %PATH% というのを付加しておかなければならないことに注意する.<br>
			(これは環境変数PATHの元々の値も忘れずに付加しておくということである).<br>
			そうしておかないと今度はMinGW系以外の他のコマンドが実行できなくなるかもしれない.<br>
			<br>
			これで上で挙げた gcc.exe などがフルパスを指定することなく単にgcc.exe(gccでもよい)と<br>
			入力するだけで実行可能となる. 何なら試しにgccと入力してEnterキーを押してみよう.<br>
			「gcc: fatal error: no input files」と出たら成功である.<br>
			一方、「gccは内部コマンドまたは外部コマンド～なんたらかんたら～として認識されていません」<br>
			と出たら失敗である. このエラーは、gccという名のコマンドをPATHに指定されたフォルダから検索したが、<br>
			どのフォルダ内にも見つからなかったということを示す.<br>
			上記のPATHの設定において何かを間違えている可能性がある(例えばフォルダ名の打ち間違えなど).<br>
			<br>
			最後にいよいよmingw32-makeコマンドにより、Makefileの内容を実行する.<br>
			以下のコマンドを実行するとすべてのコンパイルが開始され、実行バイナリが作られる.<br>
			<br>
			<div class=MstyComment>
				<div class=MstyCode>
					mingw32-make -f Makefile_mingw.mak<br>
				</div>
			</div>
			<br>
			Makefile_mingw.makというのがMoaiをコンパイルするためのMinGW向けMakefileである.<br>
			mingw32-make では -f オプションを指定することにより、Makefileを直接指定して実行できる.<br>
			<br>
		</div>
	</font><br>
	<b><a class=MstyElemLink href=#Index>目次に戻る</a></b>
</ul><br>


<a name=compile_by_vc></a>
<u><b>WindowsでVCを使ってコンパイルする(Moai Ver1.1.8向け)</b></u>
<ul>
	<font >
		これを使われているような方は既にある程度わかっておられる方だとは思う.<br>
		<br>
		srcフォルダにある<b>compile_by_vc.bat</b>をクリックして実行しよう.<br>
		VCが適切にインストールされているならば、すべてのコンパイルが自動で行われ、<br>
		out_dir内に目的のexeファイルやdllが生成されるはずである.<br>
		即ち、以下のものである.<br>
		<br>
		<ul>
			<li>src/libZnk/out_dir/Znk-1.1.dll</li>
			<li>src/moai/out_dir/moai.exe</li>
			<li>src/http_decorator/out_dir/http_decorator.exe</li>
			<li>src/plugin_futaba/out_dir/futaba.dll</li>
			<li>src/plugin_2ch/out_dir/2ch.dll</li>
		</ul>
		<br>
		後はこれらを(srcフォルダとは別の)bin_for_win32フォルダ配下へ適切にコピーするだけなのだが<br>
		コピー先はそれぞれ以下のようになる(pluginだけはpluginsというフォルダに入れる必要がある).<br>
		<br>
		<ul>
			<li>bin_for_win32/Znk-1.1.dll</li>
			<li>bin_for_win32/moai.exe</li>
			<li>bin_for_win32/http_decorator.exe</li>
			<li>bin_for_win32/plugins/futaba.dll</li>
			<li>bin_for_win32/plugins/2ch.dll</li>
		</ul>
		<br>
		さらにbin_for_win32が全くの空の状態なら、実行バイナリ以外にその他の設定ファイルもコピーしておく必要がある.<br>
		面倒なら srcフォルダにある<b>install_bin_for_win32.bat</b>を実行すればこのコピーまで自動的に<br>
		行ってくれるので活用するとよい.<br>
		<br>
		VCよるコンパイルに関しては以上である.<br>
		<br>
		<div class=MstyComment>
			<u><b>参考：compile_by_vc.bat が内部で行っていること</b></u><br>
			<br>
			ここではcompile_by_vc.bat を使わずに設定する方法を述べる.<br>
			換言すればcompile_by_vc.bat が内部で行っていることの解説でもある.<br>
			<br>
			Moaiのコンパイルはすべてコマンドラインベースで行うことができる.<br>
			(IDEを起動する必要は一切ない)<br>
			またそれらを一括で実行するためのルールが記述されたMakefileも用意されており、<br>
			nmakeコマンドを使うことでこのMakefileの内容を実行できる.<br>
			<br>
			では具体的な手順を説明しよう.<br>
			まず<a href=/common/complementary.html#command_prompt target=_blank>コマンドプロンプト</a>を開き、nmake.exe が実行できるように環境変数を整える.<br>
			<br>
			通常はこれらを我々が手動で全部設定する必要はなく、VCのインストールディレクトリ配下に<br>
			これらを自動設定するためのbatファイルが存在するのでそれを使う. <br>
			<br>
			これはVCのバージョンによって場所と名前と中身が異なるがVC6.0を除き、vsvars32.bat という名前になっている.<br>
			尚、VC7.0以降、VCがインストールされた場合は VS??COMNTOOLS (??にはバージョン番号が入る)という形式の<br>
			環境変数が設定される. これを利用してvsvars32.batの場所を特定することができる.<br>
			同梱してあるスクリプト setenv_vc.batはこれを実現するものである.<br>
			そしてcompile_by_vc.batは内部でまずこれを呼び出す.<br>
			<br>
			最後にいよいよnmakeコマンドにより、Makefileの内容を実行する.<br>
			以下のコマンドを実行するとすべてのコンパイルが開始され、実行バイナリが作られる.<br>
			<br>
			<div class=MstyComment>
				<div class=MstyCode>
					nmake -f Makefile_vc.mak<br>
				</div>
			</div>
			<br>
			Makefile_vc.makというのがMoaiをコンパイルするためのVC向けMakefileである.<br>
			nmake では -f オプションを指定することにより、Makefileを直接指定して実行できる.<br>
			<br>
		</div>
		<br>
		<div class=MstyComment>
			<u><b>参考：vsvars32.bat が内部で行っていること</b></u><br>
			<br>
			あなたがこの領域まで興味を持つことは素晴らしいことである.<br>
			我々もそれに丁寧にお答えしよう！<br>
			<br>
			整えなければならない環境変数は、PATH, INCLUDE, LIB である.<br>
			Makefile内で使われるすべてのVC系コマンドは以下であり、<br>
			つまり環境変数PATHには、これらが存在するフォルダのパスを追加的にセットする形になる.<br>
			<br>
			<div class=MstyComment>
				cl.exe<br>
				link.exe<br>
				lib.exe<br>
				nmake.exe<br>
			</div>
			<br>
			しかし実のところこれだけでは不十分で、さらに<b>上記のコマンドが依存するdll</b>が含まれるフォルダも<br>
			同様に追加しなければならない. 厄介なことにそのフォルダはこれらのコマンドの置いてあるフォルダとは<br>
			<b>別(大抵はCommon7配下のどこか)</b>である.<br>
			<br>
			例えば 上記のコマンドが C:\Program Files\Microsoft Visual Studio 8\VC\bin 内にあるならば<br>
			コマンドプロンプト上で以下のように入力する(行の最後毎にEnterキーを押すこと).<br>
			<br>
			<div class=MstyComment>
				<div class=MstyCode>
					set PATH=C:\Program Files\Microsoft Visual Studio 8\VC\bin;%PATH%<br>
					set PATH=C:\Program Files\Microsoft Visual Studio 8\Common7\IDE;%PATH%<br>
					set PATH=C:\Program Files\Microsoft Visual Studio 8\Common7\Tools%PATH%<br>
					set PATH=C:\Program Files\Microsoft Visual Studio 8\Common7\Tools\Bin;%PATH%<br>
				</div>
			</div>
			<br>
			最後に ; 区切りで %PATH% というのを付加しておかなければならないことに注意する.<br>
			(これは環境変数PATHの元々の値も忘れずに付加しておくということである).<br>
			そうしておかないと今度はVC系以外の他のコマンドが実行できなくなるかもしれない.<br>
			<br>
			これで上で挙げた cl.exe などがフルパスを指定することなく単にcl.exe(clでもよい)と<br>
			入力するだけで実行可能となる. 何なら試しにclと入力してEnterキーを押してみよう.<br>
			「Microsoft.. Optimize Compiler...うんたらかんたら」と出たら成功である.<br>
			<br>
			一方、「clは内部コマンドまたは外部コマンド～なんたらかんたら～として認識されていません」<br>
			と出たら失敗である. このエラーは、clという名のコマンドをPATHに指定されたフォルダから検索したが、<br>
			どのフォルダ内にも見つからなかったということを示す.<br>
			上記のPATHの設定において何かを間違えている可能性がある(例えばフォルダ名の打ち間違えなど).<br>
			<br>
			しかし、上記は長い…長すぎる！<br>
			最近のコマンドプロンプトでは、tabキーを使えばフォルダパスを入力する時等で自動的な補完ができるとはいえ、<br>
			こんなものを毎回入力などやっていられないので、ここで一つbatファイルを用いるテクニックを紹介しよう.<br>
			テキストエディタ(メモ帳など)を開き、上記のコマンドをコピペして例えばmy_set_path.batという名前で保存する.<br>
			あとはコマンドプロンプト上から以下を入力すれば、上記のコマンド群を一括して実行できる.<br>
			<br>
			<div class=MstyComment>
				<div class=MstyCode>
					call my_set_path.bat
				</div>
			</div>
			<br>
			コマンドプロンプトから直接実行するなら call はつけてもつけなくてもどちらでもよいのだが、<br>
			batファイルから他のbatファイルを呼び出す場合は call が必要になる.<br>
			常に call を付けるものだと習慣付けておけば間違いない.<br>
			<br>
			環境変数INCLUDEに関しては、ヘッダの存在するフォルダのパスを環境変数PATHと同様の形式で設定する.<br>
			さしあたって必要なのは標準Cライブラリのヘッダ(stdio.hなど)の存在するフォルダと<br>
			WindowsAPI(これはPlatformSDKとも呼ばれる)のヘッダ(windows.hなど)の存在するフォルダの２つである.<br>
			例えば以下のようになる.<br>
			<br>
			<div class=MstyComment>
				<div class=MstyCode>
					set INCLUDE=C:\Program Files\Microsoft Visual Studio 8\VC\include;%INCLUDE%<br>
					set INCLUDE=C:\Program Files\Microsoft Visual Studio 8\VC\PlatformSDK\include;%INCLUDE%<br>
				</div>
			</div>
			<br>
			環境変数LIBに関しては、ライブラリ(拡張子lib)の存在するフォルダのパスを環境変数PATHと同様の形式で設定する.<br>
			さしあたって必要なのは標準Cライブラリ(libcmt.libなど)の存在するフォルダと<br>
			WindowsAPI(これはPlatformSDKとも呼ばれる)のライブラリ(Kernel32.libなど)の存在するフォルダの２つである.<br>
			例えば以下のようになる.<br>
			<br>
			<div class=MstyComment>
				<div class=MstyCode>
					set LIB=C:\Program Files\Microsoft Visual Studio 8\VC\lib;%LIB%<br>
					set LIB=C:\Program Files\Microsoft Visual Studio 8\VC\PlatformSDK\lib;%LIB%<br>
				</div>
			</div>
			<br>
		</div>
	</font><br>
	<b><a class=MstyElemLink href=#Index>目次に戻る</a></b>
</ul><br>


<a name=compile_on_linux></a>
<u><b>Linuxでコンパイルする(Moai Ver1.1.8向け)</b></u>
<ul>
	<font >
		これを使われているような方は既にある程度わかっておられる方だとは思う.<br>
		<br>
		以下のコマンドが実行できるように必要に応じてこれらをインストールする.<br>
		<br>
		<div class=MstyComment>
			gcc<br>
			g++<br>
			ld<br>
			ar<br>
			ranlib<br>
			make<br>
		</div>
		<br>
		これらはどれも C/C++での開発において最低限必要となる基本コマンドばかりである.<br>
		個別にインストールしてもよいが、Development系のカテゴリにある基本パッケージをインストールすれば<br>
		まずすべて自動でインストールされると思う（例えばArch Linuxなら pacman で base-devel をインストールする). <br>
		具体的なインストール方法はそれぞれのLinuxディストリビューションによって千差万別なのでここでは記載しない. <br>
		ディストリビューションによっては最初からインストールされている可能性も高い.<br>
		<br>
		その上でターミナル(xterm, urxvtなどなんでもよいが)を開き、srcディレクトリ内の以下のシェルスクリプトを実行する.<br>
		<br>
		<div class=MstyComment>
			<div class=MstyCode>
				./compile_on_linux.sh
			</div>
		</div>
		<br>
		このシェルスクリプトにより、Makefile_linux.mak の存在する全ディレクトリへ自動的に移動しつつ<br>
		make -f Makefile_linux.mak が実行される.<br>
		この時点でコンパイル後のバイナリは、各ディレクトリ内のout_dirに格納されている.<br>
		即ち、以下のものである.<br>
		<br>
		<ul>
			<li>src/libZnk/out_dir/libZnk.so</li>
			<li>src/moai/out_dir/moai</li>
			<li>src/http_decorator/out_dir/http_decorator</li>
			<li>src/plugin_futaba/out_dir/futaba.so</li>
			<li>src/plugin_2ch/out_dir/2ch.so</li>
		</ul>
		<br>
		( Permission deniedのようなエラーメッセージが表示されてこのシェルスクリプトが実行できない場合は、<br>
		まず chmod 755 *.sh で「実行権限」を与え、再度試してみよう.<br>
		あるいは sh ./compile_on_linux.sh のように実行してもよい. )<br>
		<br>
		次に、上でコンパイルした全バイナリや設定ファイルをインストールするには、以下を実行すればよい.<br>
		<div class=MstyComment>
			<div class=MstyCode>
				./install_bin_for_linux.sh
			</div>
		</div>
		<br>
		これにより、srcディレクトリとは別の bin_for_linux へ必要なすべてのファイルがインストールされる.<br>
		以上でコンパイルおよびインストールは完了である.<br>
		<br>
		srcディレクトリを出てbin_for_linuxディレクトリへと移動し、moaiを起動しよう.<br>
		以下のようなメッセージが表示されればmoaiは無事起動している.<br>
		<br>
		<div class=MstyComment>
			Moai : config load OK.<br>
			Moai : target load OK.<br>
			Moai : analysis load OK.<br>
			Moai : Filter Loading [filters/….myf]<br>
			Moai : Plugin Loading [plugins/….so]<br>
			…<br>
			Moai : acceptable_host=[LOOPBACK]<br>
			Moai : blocking_mode=[0]<br>
			Moai : AutoGet PrivateIP=[192.168.…].<br>
			Moai : Listen port 8124...<br>
			<br>
			Moai : ObserveR : 1-th sock events by select.<br>
		</div>
		<br>
		この状態でブラウザにおけるプロキシ設定で接続先を127.0.0.1:8124に設定すれば、<br>
		moaiをローカルプロキシとして機能させることができるはずである.<br>
	</font><br>
	<b><a class=MstyElemLink href=#Index>目次に戻る</a></b>
</ul><br>


<a name=compile_on_cygwin></a>
<u><b>Cygwinでコンパイルする(Moai Ver1.1.8向け)</b></u>
<ul>
	<font >
		既にCygwinを愛用されており、MinGWなどの競合開発環境をわざわざインストールしたくない方もおられると思う.<br>
		この項目はそのような方向けである.<br>
		<br>
		<div class=MstyComment>
			<u><b>注意</b></u><br>
			<br>
			Cygwinではややこしいことに、この上で動作するMinGWをインストールすることもできる.<br>
			その場合gccオプションとして -mno-cygwinを使うことで(Cygwin版gccではなく)MinGW版gccを呼び出すこともできる.<br>
			ここではムダにややこしくしたくないため、そのような使い方については対応しない.<br>
			つまり作成を目指す実行バイナリは純粋なWindows APIをベースとしたプログラムではなく、<br>
			cygwin1.dllなどのCygwin固有のdllをベースとしたUNIXエミュレーションで動作するプログラムとする.<br>
			(Cygwin本来の趣旨は後者であろう).<br>
			<br>
			MinGWでWindows純正のプログラムとしてコンパイルしたい場合は、<br>
			上記<a href=#compile_by_mingw>WindowsでMinGWを使ってコンパイルする</a>を参照していただきたい.<br>
			あるいはMSYSを使うという手もあるがMoai Ver1.1.8では未対応である.<br>
			( Moai Ver2.0以降よりMSYSでのコンパイルにも対応している ).<br>
			どうしてもCygwin上でMinGWを使いたい方はMakefile_cygwin.makを各自修正する必要がある.<br>
			生成されるdll名の微調整やコマンドラインオプション -mno-cygwin を追加する程度の変更で済むとは思う.<br>
			<br>
		</div>
		<br>
		Cygwinインストーラ(setup-x86.exe)では、gcc-core, gcc-g++, make, binutilsをインストールしておく.<br>
		( binutilsとは、ld, ar, ranlib, asコマンドなどを含むパッケージである ).<br>
		これらはどれも C/C++での開発において最低限必要となる基本パッケージである.<br>
		setup-x86.exe においてこれらを個別にインストールしてもよいが、<br>
		Develカテゴリにこれらは全て含まれているので面倒ならこのカテゴリごと一括でインストールしてもよい.<br>
		<br>
		その上でCygwinターミナルを開き、以下のシェルスクリプトを実行する.<br>
		<br>
		<div class=MstyComment>
			<div class=MstyCode>
				./compile_on_cygwin.sh
			</div>
		</div>
		<br>
		このシェルスクリプトにより、Makefile_cygwin.mak の存在する全ディレクトリへ自動的に移動しつつ<br>
		make -f Makefile_cygwin.mak が実行される.<br>
		この時点でコンパイル後のバイナリは、各ディレクトリ内のout_dirに格納されている.
		即ち、以下のものである.<br>
		<br>
		<ul>
			<li>src/libZnk/out_dir/cygZnk.dll</li>
			<li>src/moai/out_dir/moai.exe</li>
			<li>src/http_decorator/out_dir/http_decorator.exe</li>
			<li>src/plugin_futaba/out_dir/cygfutaba.dll</li>
			<li>src/plugin_2ch/out_dir/cyg2ch.dll</li>
		</ul>
		<br>
		尚、Cygwinの場合、出来上がるdllの名前にはcygプリフィックスをつけている.<br>
		これば別に必須というわけではないのだが、Cygwin用のdllはVCやMinGWにより生成する普通のdllとは一部異なるため、<br>
		区別するためにこのようにしてある. <br>
		<br>
		次に、上でコンパイルした全バイナリや設定ファイルをインストールするには、以下を実行すればよい.<br>
		<br>
		<div class=MstyComment>
			<div class=MstyCode>
				./install_bin_for_cygwin.sh
			</div>
		</div>
		<br>
		これにより、srcディレクトリとは別の bin_for_cygwin へ必要なすべてのファイルがインストールされる.<br>
		以上でコンパイルおよびインストールは完了である.<br>
		<br>
		srcディレクトリを出てbin_for_cygwinディレクトリへと移動し、moaiを起動しよう.<br>
		以降はLinux版と同じである.<br>
	</font><br>
	<b><a class=MstyElemLink href=#Index>目次に戻る</a></b>
</ul><br>


<a name=compile_on_msys></a>
<u><b>MSYSを使ってコンパイルする(Moai Ver2.0以降)</b></u>
<ul>
	<font >
		ここではMSYS1.0を使用したMinGWによるコンパイル手順を示す.<br>
		(申し訳ないがMSYS2.0の場合は<s>面倒くせーので</s>解説しない).<br>
		<br>
		また、MSYSを使ったMoaiのビルドに正式に対応しているのは Moai Ver2.0以降である.<br>
		Moai Ver1.1.8以前ではMSYSでのコンパイルには対応していない.<br>
		(Ver1.1.8では、MSYS用 のMakefile( Makefile_msys.mak )が標準では用意されていない.<br>
		このようなMakefileをあなたが自分で作れば、多分大丈夫だろうけども.)<br>
		<br>
		MSYS1.0をまだインストールされていない方は、まずは<a href=#get_mingw>MinGWの入手方法</a>を先にご一読願いたい.<br>
		既にそちらをご一読されている方はもうお分かりだと思うが、<br>
		<br>
		<b>C:\MinGW\bin\mingw-get.exeを実行すれば後からでも追加インストールできます</b>のでご安心を<br>
		…いただけるのだった.<br>
		<br>
		この C:\MinGW\bin\mingw-get.exe こそがMinGWの本当のインストーラであり、<br>
		Installation Managerと呼ばれるものである<br>
		…のだった.<br>
		<br>
		実はこのInstallation ManagerからMSYS1.0も追加インストールできる.<br>
		というわけで、まずはmingw-get.exeを実行しよう.<br>
		その後の具体的な手順を以下に示す.<br>
		<br>
		<ol>
			<li>「MinGW Installation Manager」と書かれたウィンドウが表示されるので<br>
			ここからインストールしたい項目を選ぶ.<br>
			<br>
			まず左側のペインにおいて「Basic Setup」を選んだ状態にし、<br>
			右側のペインで<b>msys-base</b>とある行の四角形のところをクリックする(あるいは右クリックでもよい).<br>
			このときプルダウンメニューが表示されるので「Mark for Installation」を選ぶ.<br>
			四角形のところに<b>オレンジ色の矢印マーク</b>が表示されれば選択された状態になったことを意味する.<br>
			</li>
			<br>
			<li>いよいよ実際のパッケージ本体をダウンロードおよびインストールする.<br>
			一番左上にある「Installation」メニューを開き、「Apply Changes」を選ぶ.<br>
			「Schedule of Pending Actions」というウィンドウが現れるので「Apply」ボタンを押せば<br>
			実際にパッケージ群がずらーっとダウンロードおよびインストールされる.<br>
			<br>
			パッケージは勿論圧縮されてあるのでダウンロードは大して時間は掛からない.<br>
			またインストールといってもたいしたことをしているわけではなく、<br>
			C:\MinGW配下に必要な圧縮ファイルが解凍されるだけのことである.<br>
			<b>msys-base</b> だけの場合、展開後は合計20MBほどになる.<br>
			</li>
			<br>
			<li>「Applying Scaduled Changes」というウィンドウが出て「All changes were applied successfully;」<br>
			などと書いてあれば成功である. 「Close」ボタンを押そう.<br>
			「MinGW Installation Manager」ウィンドウがまだ表示されていると思うがこれも右上のxボタンで閉じてよい.<br>
			</li>
			<br>
			<li>C:\MinGWフォルダを開いてみよう.<br>
			<b>msys\1.0</b>というフォルダが新しく出来ているはずであり、これがMSYSの本体である.<br>
			この中に入るとmsys.batというファイルがあるのがわかる.<br>
			これをクリックして実行するとMSYSのターミナルウィンドウが開く.<br>
			毎回このフォルダまで入ってこれをクリックするのが面倒なら、<br>
			デスクトップにこのmsys.batへのショートカットを作っておくのもよいだろう.<br>
			<br>
			プロンプトの部分に「/home/あなたのユーザ名」のような表示がなされているはずだ.<br>
			これがカレントディレクトリを示しているが、これは一体どこなのだろうか？<br>
			</li>
			<br>
			<li>そう！<b>我々が最初に打つべきコマンドは mount である</b>.<br>
			現在どのWindows上のどのフォルダが、MSYS内のどのディレクトリにマウントされているか？<br>
			mountコマンドを打つことでこれを確認できる.<br>
			では早速確認してみよう.<br>
			<br>
			<div class=MstyComment>
				<div class=MstyCode>
					$ mount<br>
					C:\MinGW\msys\1.0 on /usr   type user (binmode,noumount)<br>
					C:\MinGW\msys\1.0 on /      type user (binmode,noumount)<br>
					C:\MinGW\msys\1.0 on /mingw type user (binmode)<br>
					C:\Users\Zenkaku\AppData\Local\Temp on /tmp type user (binmode,noumount)<br>
					c: on /c type user (binmode,noumount)<br>
				</div>
			</div>
			<br>
			上記より、ルートディレクトリ(/)はC:\MinGW\msys\1.0であることがわかる.<br>
			つまりMSYS上で /home/Zenkaku となっていればその実体は C:\MinGW\msys\1.0\home\Zenkakuフォルダということだ.<br>
			</li>
			<br>
			<li>次にmakeコマンドが使えるかどうかを確認する.<br>
			<br>
			<div class=MstyComment>
				<div class=MstyCode>
					$ make<br>
					make: *** No targets specified and no makefile found.  Stop.<br>
				</div>
			</div>
			<br>
			無事上記のような表示になれば、MSYSはmakeコマンドを認識している.<br>
			whichコマンドを使えば、make.exeの実体は C:\MinGW\msys\1.0\bin\make.exeということもわかる.<br>
			<br>
			<div class=MstyComment>
				万一 sh: make command not found などと表示されたら、何らかの理由で<br>
				make.exe がきちんとインストールされていないということだ.<br>
				念のため、上記に戻って「MinGW Installation Manager」からmsys-baseをインストールしなおそう.<br>
				<br>
				また左ペインにおいて「All Packages」⇒「MSYS」⇒「MSYS Base System」を選ぶと<br>
				msys-make がインストールされているかどうかをピンポイントで確認することもできる.<br>
				万一これがインストール状態になっているにも関わらずこの症状が出るなら、<br>
				おそらくは C:\MinGW\var\cache\mingw-get\packages\make-3.81-3-msys-1.0.13-bin.tar.lzma が壊れている.<br>
				(あなたの環境ではこのファイル名は若干異なるかもしれない).<br>
				まずはこのファイルを削除し、さらにあなたが普段使っているブラウザのキャッシュを消した上で<br>
				再度インストールを試みた方がいいだろう.<br>
			</div>
			</li>
			<br>
			<li>次にgccコマンドが使えるかどうかを確認する.<br>
			<br>
			<div class=MstyComment>
				<div class=MstyCode>
					$ gcc<br>
					sh: gcc: command not found<br>
				</div>
			</div>
			<br>
			無事上記のような表示になれば…、いや無事ではない！<br>
			MSYSはgccコマンドを認識していないのだ！<br>
			なぜか？<br>
			<br>
			我々は既にMinGW本体はインストールしてある.<br>
			gcc.exe の実体はC:\MinGW\bin配下にあるはずである.<br>
			この位置をMSYSに教えねばならない.<br>
			そのためにはMinGWのトップフォルダC:\MinGW をMSYSでの /mingw ディレクトリとして<br>
			マウントさせなければならないのである.<br>
			<br>
			C:\MinGW\msys\1.0\etc\fstab.confをテキストエディタで開こう.<br>
			もしもこれが存在しなければ、まず同フォルダ内のfstab.sample を fstab.confと言う名前でコピーしてそれを開こう.<br>
			このファイルでは # で始まる行は単なる説明文なので無視してよく、それ以外の行に注目しよう.<br>
			次のような行があるのではなかろうか？<br>
			<br>
			<div class=MstyComment>
				<div class=MstyCode>
					c:/mingw	/mingw<br>
				</div>
			</div>
			<br>
			二つ値があるが、左側がWindowsでの実体をあらわすパス、右側がそのMSYS上でのディレクトリを示す.<br>
			今、/mingwに相当する実体のパスをきちんと設定したいのであるから、我々が修正すべきはこの左側である.<br>
			もしもあなたのMinGWがインストールされたフォルダがC:\MinGWではないなら、<br>
			上記の左側(c:/mingwの部分)をあなたのMinGWがインストールされたフォルダのパスへ<br>
			正しく書き換える必要がある.<br>
			書き換えたらこのファイルを上書き保存しよう.<br>
			</li>
			<br>
			<li>再度gccコマンドが使えるかどうかを確認する.<br>
			<br>
			<div class=MstyComment>
				<div class=MstyCode>
					$ gcc<br>
					sh: gcc: command not found<br>
				</div>
			</div>
			<br>
			無事に sh: gcc: command not found と表示されたであろうか？<br>
			そう！まだダメである！<br>
			なぜか？<br>
			<br>
			実は我々はまだ最後の仕上げを一つ忘れているのである.<br>
			そう！<b>我々が最後に打つべきコマンドは mount である</b>.<br>
			上記の /etc/fstab.confに書かれた内容を反映させるには、次のようにしてmountコマンドを実行する必要がある.<br>
			<br>
			<div class=MstyComment>
				<div class=MstyCode>
					$ mount /mingw<br>
				</div>
			</div>
			<br>
			万一 '/mingw' is already mounted などと表示されたら、一旦/mingwをアンマウントしてから、<br>
			再度マウントする必要がある. 次のようになるだろう.<br>
			<br>
			<div class=MstyComment>
				<div class=MstyCode>
					$ umount /mingw<br>
					$ mount /mingw<br>
				</div>
			</div>
			<br>
			将来、MinGWフォルダの位置を移動するなどして /etc/fstab.confの内容を書き直したら<br>
			このアンマウント/マウントを再度実行する必要があるので注意しよう.<br>
			</li>
		</ol>
		<br>
		非常に長かったが、これにて一件落着インストール完了である.<br>
		<br>
		あとは、MSYSターミナル上でMoaiのsrcディレクトリに移動し、<br>
		さらに次の順番で各フォルダを巡回して<span class=MstyCode>make -f Makefile_msys.mak install</span>を実行していけばよいだろう.<br>
		<br>
		<ul>
			<li>src/libZnk</li>
			<li>src/libRano</li>
			<li>src/moai</li>
			<li>src/easter</li>
			<li>src/custom_boy</li>
			<li>src/proxy_finder</li>
			<li>src/cgi_developers</li>
			<li>src/plugin_futaba</li>
			<li>src/plugin_5ch</li>
		</ul>
		<br>
		こんなにいっぱい全部やってらんないって方は、srcディレクトリにある make_world.sh を以下のようにして実行しよう.<br>
		<br>
		<div class=MstyComment>
			<div class=MstyCode>
				$ sh ./make_world.sh install<br>
			</div>
		</div>
		<br>
		これで上記のディレクトリすべてを自動的に巡回して<span class=MstyCode>make -f Makefile_msys.mak install</span>が実行される.<br>
		つまりすべてがコンパイルされすべてがインストールされる(最初からそれを言えって？）.<br>
		<br>
	</font><br>
	<b><a class=MstyElemLink href=#Index>目次に戻る</a></b>
</ul><br>

<a name=compile_on_others_windows></a>
<u><b>WindowsでBCC5.5(Borland C++ Compiler 5.5)またはDMC(Digital Mars C/C++)を使ってコンパイルする</b></u>
<ul>
	<font >
		あなたが(MinGWでもVCでもCygwinでもなく)あえてこれらを選ぶというなら、もはや我々は何も言うまい.<br>
		我々もそれに答えるべく、そのヒントをここで示そう.<br>
		<br>
		これら用のmakefileはかさばるので同梱していないが、実のところソースコード自体は<br>
		これらでもビルドできるように移植性に一応配慮してある.<br>
		興味がある<b>奇特な方</b>は、以下を参考に各自makefileを作成して欲しい.<br>
		<br>
		<li><b>BCC5.5(Borland C++ Compiler 5.5)</b><br>
		objを作る場合の指定方法(コンパイラはbcc32となる)<br>
		<div class=MstyComment>
			<div class=MstyCode>
				bcc32 -w -RT -c -oYourFile.obj YouFile.c<br>
			</div>
		</div>
		<br>
		exeを作る場合の指定方法(リンカはilink32となる)<br>
		OBJSは、+記号で各objファイルを連結したものを指定するという変態仕様である.<br>
		<div class=MstyComment>
			<div class=MstyCode>
				ilink32 -w -Gn -C -Tpe -ap c0x32.obj $(OBJS) $(LFLAGS),YourApplication.exe,,import32.lib cw32mt.lib,,YourResource.res<br>
			</div>
		</div>
		<br>
		静的ライブラリ(lib)を作る場合の指定方法(ライブラリアンはtlibとなる)<br>
		オプション /P4096 はページサイズとなり、OMF形式ではこれを明示的に指定する必要がある.<br>
		<div class=MstyComment>
			<div class=MstyCode>
				tlib YourStaticLib.lib /P4096 $(OBJS)<br>
			</div>
		</div>
		<br>
		dllおよびそれに対応するインポートライブラリを作る場合の指定方法.<br>
		(インポートライブラリはimplibを使用してdllあるいはdefファイルから自動生成する.)<br>
		(尚、この方法は__stdcallには対応しない)<br>
		<div class=MstyComment>
			<div class=MstyCode>
				ilink32 -w -Gn -C -Tpd c0d32x.obj $(OBJS) $(LFLAGS),YourDLL.dll,,import32.lib cw32mt.lib,YourDLL.def<br>
				implib -f -a YourDLL.lib YourDLL.dll<br>
				( あるいは implib -f -a YourDLL.lib YourDLL.def )<br>
			</div>
		</div>
		</li>
		<br>
		<li><b>DMC(Digital Mars C/C++)</b><br> 
		我々が実際にテストしたのは最新バージョン(Ver8.57)のみである.<br>
		<br>
		objを作る場合の指定方法(コンパイラはdmcとなる)<br>
		<div class=MstyComment>
			<div class=MstyCode>
				dmc -HP99 -Bj -j0 -Ab -Ae -Ar -w6 -c -oYourFile.obj YouFile.c<br>
			</div>
		</div>
		<br>
		exeを作る場合の指定方法(リンカはlinkとなる)<br>
		<div class=MstyComment>
			<div class=MstyCode>
				link -EXET:NT $(OBJS),YourApplication.exe,,ws2_32.lib user32.lib kernel32.lib,,YourResource.res
			</div>
		</div>
		<br>
		静的ライブラリ(lib)を作る場合の指定方法(ライブラリアンはlibとなる)<br>
		オプション -p4096 はページサイズとなり、OMF形式ではこれを明示的に指定する必要がある.<br>
		<div class=MstyComment>
			<div class=MstyCode>
				lib -c -p4096 YourStaticLib.lib $(OBJS)
			</div>
		</div>
		<br>
		dllおよびそれに対応するインポートライブラリを作る場合の指定方法.<br>
		(インポートライブラリはimplibを使用してdllから自動生成する.)<br>
		<div class=MstyComment>
			<div class=MstyCode>
				link -EXET:NT $(OBJS),YourDLL.dll,,ws2_32.lib user32.lib kernel32.lib,YourDLL.def<br>
				implib /system YourDLL.lib YourDLL.dll<br>
			</div>
		</div>
		</li>
		<br>
	</font><br>
	<b><a class=MstyElemLink href=#Index>目次に戻る</a></b>
</ul><br>


<a name=compile_on_android></a>
<u><b>Android版をコンパイルする(Moai Ver1.1.8向け)</b></u>
<ul>
	<font >
		Androidは基本的にLinuxであるが、PC Linuxとは大きく異なる部分もある.<br>
		そして通常、AndroidにおけるアプリはJava VMをベースとして(エントリポイントとして)提供される.<br>
		Java VMベースなアプリでは、グラフィカルなアイコンがホーム画面に表示され、<br>
		それをタップすることで起動する.<br>
		<br>
		しかしながら、今回ビルドする Moai for Android はJava VMベースではなく<br>
		AndroidのLinux上で直接走るネイティブアプリとしてC言語で開発する.<br>
		この場合ホーム画面にMoai用の特別なアイコンが表示されることはない.<br>
		Moaiを起動するには、まず端末エミュレータを開き、cdコマンドにより<br>
		moai実行バイナリが存在するディレクトリ(bin_for_android)へと移動してから<br>
		moai実行バイナリを直接起動する形になる.<br>
		要するにLinux環境のターミナルなどでプログラムを起動するのと同じ要領で行う.<br>
		<br>
		さて、前置きが長くなったが、ネイティブアプリとしてC言語のソースコードをコンパイルするには<br>
		Android NDKを使う.<br>
		<div class=MstyComment>
			この記事では、執筆時点で配布されているr12を例にとる.<br>
			あなたが入手するAndroid NDK最新バージョンでは仕様が変わっている可能性があることをご了承願いたい)<br>
		</div>
		<br>
		Android NDKは <a href=https://developer.android.com/ndk/downloads/index.html target=_blank>http://developer.android.com/ndk/downloads/index.html</a>よりダウンロードできる.<br>
		また開発はAndroid上では行えないためPCが必要である.<br>
		つまりAndroid NDKは、あなたの開発用PCへダウンロードしこのPC上にて開発を行う.<br>
		<br>
		しかし Android NDKのファイルサイズはかなり大きいので注意してほしい.<br>
		ダウンロードするzipファイルは約750MB程度もあり、さらにこれを解凍展開するとなんと<b>3GB</b>ほどにもなる！<br>
		つまりこれらを単純に合計しただけでもディスクの空きが4GB程度必要となる.<br>
		さらにWindows上でコンパイルする場合、Moai Ver1.1.8ではCygwinを使うことを想定する.<br>
		<br>
		<div class=MstyComment>
			<u><b>Moai Ver2.0について</b></u><br>
			<br>
			Moai Ver2.0ではCygwinを使わずにコンパイルすることもできるようになった.<br>
			(Cygwinを使用した旧来どおりの方法もでもできるけれども)<br>
			<br>
			Moai Ver2.0ではあなたはまず環境変数ZNK_NDK_DIRでAndroid NDKのトップディレクトリを指定した上で、<br>
			srcフォルダの直下にあるmake_world.batを実行する.<br>
			<br>
			古き良き時代を彷彿とさせるコマンドラインベースでのメニュー選択UIが表示されるので、<br>
			「3. switch debug-mode」を何回か選んでDEBUG_MODEを「optimize」にし、<br>
			「4. switch mkfid」を何回か選んでMKF_IDを「android」にし、<br>
			「5. switch machine」を何回か選んでMACHINEを「armeabi」にし、<br>
			最後に「1. make install」を選ぶとすべてが自動的にコンパイルされ、<br>
			すべてがsrcの一つ上のmoai-v2.0-android-armeabiディレクトリへとインストールされる.<br>
			<br>
			<div class=MstyComment>
				<img src=/imgs/auto_trigger_run.png width=100%><br>
			</div>
			<br>
		</div>
		<br>
		尚、<b>Android Studio および android-sdk は必要ない.</b>インストールさえも不要である.<br>
		同様に<b>JDK(Java Development Kit)やJREなども必要ない.</b><br>
		<br>
		Android NDKをダウンロードしたら、これをディスクへ解凍展開する.<br>
		無事解凍できただろうか？<br>
		なにせファイルサイズが馬鹿デカイため、解凍ツールでさえエラーなどが表示されるかもしれない.<br>
		念のため確認しよう.
		<br>
		次に android_setting_ndk.sh をテキストエディタで開き、<br>
		ZNK_NDK_HOMEの値をAndroid NDKが解凍展開されたディレクトリのパスに書きかえる.<br>
		例えばWindowsでC:\android-ndk-r12フォルダに解凍展開されているなら、<br>
		Cygwin上でのこれを示すパスは/cygdrive/c/android-ndk-r12となり、以下のように書き換える形となる.<br>
		<br>
		<div class=MstyComment>
			<div class=MstyCode>
				export ZNK_NDK_HOME=/cygdrive/c/android-ndk-r12<br>
			</div>
		</div>
		<br>
		後は以下のコマンドを順番に実行していけばよい.<br>
		(Windowsの場合はCygwinを起動してこれを実行しよう.<br>
		残念ながらWindowsではCygwinではないとこの方法は使えない.<br>
		Linuxの場合は何も問題ない.)<br>
		<div class=MstyComment>
			<div class=MstyCode>
				chmod 755 *.sh<br>
				source ./android_setting_ndk.sh<br>
				./android_compile.sh<br>
				./android_install_bin.sh<br>
			</div>
		</div>
		<br>
		src/libZnk, src/moai などにandroidディレクトリが存在するが、<br>
		この内部にあるjniディレクトリにAndroid NDKでコンパイルするためのMakefileが格納されてある.<br>
		android_compile.shを実行すると、まずこのandroid ディレクトリへ移動してndk-buildコマンドが呼び出される.<br>
		このとき、同ディレクトリに libs, obj ディレクトリが生成され、ビルドしたバイナリやライブラリなどがここに出力される.<br>
		./android_install_bin.sh を実行することで、これらのバイナリが ../bin_for_androidへとインストールされる形となる.<br>
		<br>
		最後に出来上がった bin_for_android を実機に転送した上でそれを実行する.<br>
		これには色々方法があるが、とりあえずはbin_for_androidを一旦zipファイルに固めて適当なWebサイト上にアップし<br>
		実機からこれをダウンロードするというクソ回りくどい方法が<s>ここで説明するには</s>一番簡単だ.<br>
		まあどんな方法でもよいがとりあえずなんとかこれを実機へと転送して欲しい.<br>
		<br>
		<div class=MstyComment>
			<u><b>実行するにあたっての注意</b></u><br>
			<br>
			<ol>
			<li>ホームディレクトリ以外では書き込み権限および実行権限の関係で実行できないことがある.<br>
				よってまず「端末エミュレータ」を開き、cd コマンドよりホームディレクトリへ移動する.<br>
				(単にcdと入力してEnterを押せばよい).<br>
				そしてbin_for_android.zipをダウンロードなどした場合は、<br>
				Downloadディレクトリからホームディレクトリへこれをコピーしなければならない.<br>
				Downloadディレクトリはデフォルトのブラウザからダウンロードした場合<br>
				/storage/sdcard0/Download などのパスに存在し、その配下にダウンロードしたファイルも置かれている.<br>
				以下のように実行することでこれをホームディレクトリへコピーしよう.<br>
				<br>
				<div class=MstyCode>
					cp /storage/sdcard0/Download/bin_for_android.zip ~/
				</div>
				<br>
			</li>
			<br>
			<li>bin_for_android.zip をホームディレクトリへコピーしたら、unzip bin_for_android.zip でこれを解凍展開しよう.<br>
				次に cd bin_for_android/armeabi で実行バイナリのあるディレクトリ内へと移動し、<br>
				moai および http_decorator に実行権限を与える. <br>
				以下を実行しておこう.<br>
				<br>
				<div class=MstyCode>
					chmod 755 moai http_decorator
				</div>
				<br>
			</li>
			<br>
			<li>moaiは起動時にlibZnk.soを動的ロードする.<br>
				これを成功させるためにLD_LIBRARY_PATHを適切に指定しておかなければならない.<br>
				以下を実行しておこう.<br>
				<br>
				<div class=MstyCode>
					export LD_LIBRARY_PATH=. 
				</div>
				<br>
			</li>
			</ol>
			<br>
			これでようやく準備が整った.<br>
			./moai と入力し、上記「Linuxの場合」で説明したのと同様のメッセージが表示されれば成功である.<br>
		</div>
	</font><br>
	<b><a class=MstyElemLink href=#Index>目次に戻る</a></b>
</ul><br>


<a name=about_macos></a>
<u><b>MacOSについて</b></u>
<ul>
	<font >
		現状では未サポートである.<br>
		仮にコンパイルを試みるなら(手元にないので未確認であるが)Darwinを使うことになると思う.<br>
		これにgcc, makeコマンドなどLinuxと同様のツールが含まれており、<br>
		多分Makefile_linux.makを少し手直しすれば同様の方法でビルドできるはずである.<br>
		(ダイナミックリンクライブラリの拡張子はsoではなくdylibやtbdといったものになるようである.<br>
		その他リンカldのオプションもおそらくMacOS独自のものを指定しなければならないだろう)<br>
	</font><br>
	<b><a class=MstyElemLink href=#Index>目次に戻る</a></b>
</ul><br>


<u><b>リンク</b></u>
<ul>
	<li><a class=MstyElemLink href="#TopBar">一番上へ</a></li>
	<li><a class=MstyElemLink href="https://mr-moai-2016.github.io">Moaiドキュメント(オンライン)</a></li>
	<li><a class=MstyElemLink href="https://github.com/mr-moai-2016/znk_project">znk_project(github)</a></li>
</ul><br>

</body>
</html>
