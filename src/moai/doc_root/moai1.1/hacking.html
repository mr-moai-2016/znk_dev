<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta http-equiv="Content-Script-Type" content="text/javascript">
	<meta http-equiv="Content-Style-Type" content="text/css">
	<link href="/msty.css" rel="stylesheet" type="text/css">
</head>
<body>
<a name=TopBar></a>
<p><b><img src="/imgs/here_landmark.png"> Moai1.1ドキュメント</b></p>

<a class=MstyElemLink href="/">トップページ</a> &nbsp;
<a class=MstyElemLink href="/moai2.0/index.html">Moai2.0ドキュメント</a> &nbsp;
<a class=MstyNowSelectedLink href="/moai1.1/index.html">Moai1.1ドキュメント</a> &nbsp;
<br> <br>
<a class=MstyElemLink        href="/moai1.1/install.html">インストールガイド</a> &nbsp;
<a class=MstyElemLink        href="/moai1.1/index.html">Moaiの特徴</a> &nbsp;
<a class=MstyElemLink        href="/moai1.1/moai_reference.html">Moaiリファレンス</a> &nbsp;
<a class=MstyElemLink        href="/moai1.1/local_proxy.html">ローカルプロキシ</a> &nbsp;
<a class=MstyElemLink        href="/moai1.1/FAQ.html">FAQ</a> &nbsp;
<a class=MstyElemLink        href="/moai1.1/how_to_compile.html">HowToコンパイル</a> &nbsp;
<a class=MstyNowSelectedLink href="/moai1.1/hacking.html">ハッキング</a> &nbsp;
<br> <br>

<div class=MstyComment>
<u><b>記事担当者</b></u> : 全角 ＆ Mr.Moai<br> 
<br>
<u><b>最終更新日</b></u> : 2018/03/28<br>
<br>
</div>
<br>

<a name=AtFirst></a>
<u><b>はじめに</b></u>
<ul>
	<font >
		この記事ではMoai Ver1.1.8向けソース改造および機能拡張のためのガイドラインについて<b>超適当に</b>述べる.<br>
		Moai Ver2.0をお使いの方は、この記事の内容は一部当てはまらない箇所がある.<br>
	</font><br>
</ul><br>


<a name=Index></a>
<u><b>目次</b></u>
<ul>
	<li><b><a class=MstyElemLink href=#Hacking>Hacking? ハッカーって奴っすかｗ？</a></b></li>
	<li><b><a class=MstyElemLink href=#Cooking>Cooking? ああ、アレでしょ？クッキー消去って奴</a></b></li>
	<li><b><a class=MstyElemLink href=#lang>開発言語について</a></b></li>
	<li><b><a class=MstyElemLink href=#background>開発にあたっての背景など</a></b></li>
	<li><b><a class=MstyElemLink href=#message>改造に挑戦される方へ</a></b></li>
	<li><b><a class=MstyElemLink href=#dependency>各ソースの依存関係について</a></b></li>
	<li><b><a class=MstyElemLink href=#moai_src>moai本体のソースコードの構成について</a></b></li>
	<li><b><a class=MstyElemLink href=#libZnk>libZnkについて</a></b></li>
	<li><b><a class=MstyElemLink href=#plugin>プラグインインターフェース</a></b></li>
	<li><b><a class=MstyElemLink href=#Znk_in_plugin>プラグインインターフェースで登場するlibZnk</a></b></li>
</ul><br>


<a name=Hacking></a>
<u><b>Hacking? ハッカーって奴っすかｗ？</b></u>
<ul>
	<font >
		若いのによく知ってるな！そうだあのハッカーだ…<br>
		以下に正しい定義を書いておこう.<br>
		<div class=MstyComment>
		<u><b>定義</b></u><br> <br> 
			「ハッカー」っていうのは良い子もみんなも知っている通り、コンピュータで悪いことする犯罪者で<br>
			「ハッキング」ってのはハッカーがコンピュータで<b>けしからんこと</b>することである.<br>
		</div>
		<br>
		匿名掲示板でこんなことを書くと我々の経験上、<b>鼻息を荒げながら</b>次のような反論をする謎のオッサンが現れるのである.<br>
		<!-- img src=/imgs/keshikaran.png -->
		<div class=MstyComment>
		<u><b>謎のオッサン</b></u><br> <br> 
			<b>ゆとり</b>が！
			<br>
			「ハッキング」っていうのは本来コンピュータを解析することであって、<br>
			「ハッカー」はコンピュータを解析する者のことだ!<br>
			コンピュータで悪いことする犯罪者は正しくは「クラッカー」と言い、<br>
			コンピュータでけしからんことするのは「クラッキング」と言うのだ！<br>
			<br>
			二度と間違えるなｺﾞﾙｧ！(` Д´)／ﾊｱﾊｱ<br>
		</div>
	</font><br>
	<b><a class=MstyElemLink href=#Index>目次に戻る</a></b>
</ul><br>


<a name=Cooking></a>
<u><b>Cooking? ああ、アレでしょ？クッキー消去って奴</b></u>
<ul>
	<!-- img src=/imgs/do_not_eat.png><br -->
	<font >
		さて、ハッキングの定義の話に戻るが、<br>
		我々としては、もはや<b>こんな化石のような定義</b>など今更どうでもいいわけだが、<br> 
		<s>コンピュータで悪いことする人の意味として今や社会に浸透しているので、<br>
		このドキュメントの名前もそうしておいた.</s><br>
		他に適当な言葉も思いつかなかったので、このドキュメントの名前もそうしておいた.<br>
		<br>
		ここでのHackingの意味は、<b>化石脳なオッサン達</b>が言う意味に近いが、要するにこのツールを改造したり<br>
		拡張したりするといった程度の意味である(最近ではクラッキングという言葉がこの意味でも使われたりするようである).<br>
		<br>
		というわけで長くなって悪かったな！<br>
		このドキュメントはプログラマ向けだ.<br>
		万一キミがCookingとクッキーの区別もまだついていないのなら、ここから下は<b>呪文だらけで</b>非常にデンジャラスだ！<br>
		今すぐここから脱出するんだ！<br>
	</font><br>
	<b><a class=MstyElemLink href=#Index>目次に戻る</a></b>
</ul><br>



<a name=lang></a>
<u><b>開発言語について</b></u><br>
<br>
<div class=MstyIndent>
	早速だが本題に入ろう.<br>
	Moaiでは開発言語としてCを使ってある.<br>
	そして基本的に実行効率より確実性を最優先にしてある.<br>
	<br>
	C++を使っていない理由も簡単に述べておこう.<br>
	<br>
	<ul>
		<li>多くの場合Cの方が高速である.</li>
		<li>デバッガでも追跡困難なバグを誘発しやすい.</li>
		<div class=MstyComment>
			C++ならばもっと記述は簡潔になる部分もあろうが、それは同時にデバッグの際における<br>
			非シーケンシャルかつ非直感的な処理の割合が高くなることも意味する.<br>
			例えばコンストラクタやデストラクタの発動のタイミング、コンパイラ依存の差異や癖などでこれを誘発しやすい.<br>
		</div>
	</ul>
	というわけで我々はどうでもいい開発にはC++を使うこともあるがそうではない場合はC++は基本的に使わない.<br>
	しかし、基本ライブラリであるlibZnkはC/C++いずれからでも使用可能である.<br>
	<br>
	その他メジャーなスクリプト言語(rubyやpythonなど)は大抵の場合良い選択だが、<br>
	インタプリタや付属ライブラリのバージョンアップなどで、今まで問題なく動作していたものが<br>
	突然エラーになるなどよくある話ではある. <br>
	また万一その言語に未知のバグがあったりドキュメントされていないある種の癖に由来した挙動が発生した場合、<br>
	スクリプト環境に付属した膨大なコードから原因を分析するなどやってられないので今回は不採用とした.<br>
	<br>
	<b><a class=MstyElemLink href=#Index>目次に戻る</a></b><br>
</div><br>
<br>


<a name=background></a>
<u><b>開発にあたっての背景など</b></u>
<ul>
	<font >
		ところでMoai開発にあたっては勿論参考としたツールがある.<br>
		Polipoというツールがそれにあたるのだが、これもCで記述されたオープンソースである.<br>
		Polipoは非常に優れたローカルプロキシであり、多くの部分を参考にさせてもらった.<br>
		この場を借りてJuliusz Chroboczek氏には感謝する.<br>
		ポート番号8123はPolipoで使われていたものであり、それに敬意を表しMoaiではこれに続く後輩という意味で<br>
		8124をデフォルトポートとした.<br>
	</font><br>
	<b><a class=MstyElemLink href=#Index>目次に戻る</a></b>
</ul><br>


<a name=message></a>
<u><b>改造に挑戦される方へ</b></u>
<ul>
	<font >
		あなたが改造したツールはMoaiとは別の名前で公開してもらっても勿論構わないし、<br>
		むしろその方が混乱が避けられるので有難い.<br>
		我々がPolipoを参考に新しくMoaiを開発したように、<br>
		今度はあなたがMoaiを参考に新しいツールを作られてみるのもまた一興ではないだろうか？<br>
		技術のある方は是非挑戦してもらいたい.<br>
		<br>
		勿論あなたが書くのだからお好きな言語でお好きなように書きなおし、<br>
		お好きなような機能をつけてもらうのもいいだろう.<br>
		特にMoaiはMacOSには全く未対応で、我々の開発環境の関係で今度も対応する予定がないのだが、<br>
		基本的にPosixに準拠したAPI(システムコール)しか使用していないので<br>
		多分それほどコードを修正なく対応できるのではないかと予想している.<br>
		ダイナミックリンクライブラリを比較的多く使用しているので、<br>
		MacOSのdylibあたりの特別な知識は必要になるかもしれない.<br>
		<br>
		そして改造したものを是非とも公開して戴ければ我々にとってこれ以上の喜びはない.<br>
		Moaiのライセンスは<a href=http://www.kmonos.net/nysl target=_blank>NYSL</a>であり、某ライセンスのようなソースコード開示の義務はない.<br>
	</font><br>
	<b><a class=MstyElemLink href=#Index>目次に戻る</a></b>
</ul><br>


<a name=dependency></a>
<u><b>各ソースの依存関係について</b></u>
<ul>
	<font >
		各ツールおよびライブラリの依存関係について以下に簡単に示しておく.<br>
		<br>
		<li><b>libZnk</b></li>
		<div class=MstyComment>
			依存ライブラリはなし(zlibを使用しているがソース内に同梱されてある).<br>
		</div>
		<br>
		<li><b>libRano(Ver2.0以降のみに存在)</b></li>
		<div class=MstyComment>
			libZnk<br>
		</div>
		<br>
		<li><b>moai</b></li>
		<div class=MstyComment>
			libZnk<br>
			(Ver2.0の場合libRanoにも依存)<br>
		</div>
		<br>
		<li><b>easter(Ver2.0以降のみに存在)</b></li>
		<div class=MstyComment>
			libZnk<br>
			libRano<br>
		</div>
		<br>
		<li><b>custom_boy(Ver2.0以降のみに存在)</b></li>
		<div class=MstyComment>
			libZnk<br>
			libRano<br>
		</div>
		<br>
		<li><b>proxy_finder(Ver2.0以降のみに存在)</b></li>
		<div class=MstyComment>
			libZnk<br>
			libRano<br>
		</div>
		<br>
		<li><b>http_decorator(Ver1.1.8のみに存在)</b></li>
		<div class=MstyComment>
			libZnk<br>
		</div>
		<br>
		<li><b>plugin_futaba</b></li>
		<div class=MstyComment>
			libZnk<br>
  			http_decorator(Ver1.1.8の場合のみ、これを外部ツールとして呼び出す) </li>
		</div>
		<br>
		<li><b>plugin_2ch(Ver1.1.8のみに存在)</b></li>
		<div class=MstyComment>
			libZnk<br>
  			http_decorator(外部ツールとして呼び出す) </li>
		</div>
		<br>
		<li><b>plugin_5ch(Ver2.0以降のみに存在)</b></li>
		<div class=MstyComment>
			libZnk<br>
		</div>
	</font><br>
	<b><a class=MstyElemLink href=#Index>目次に戻る</a></b>
</ul><br>



<a name=moai_src></a>
<u><b>moai本体のソースコードの構成について(Ver1.1.8向け)</b></u>
<ul>
	<font >
		以下にMoaiを構成するファイルの概要を示す.<br>
		<br>
		<li><b>Moai_connection</b></li>
		<div class=MstyComment>
			MoaiConnection型とその寿命を管理する.<br>
			MoaiConnectionとは、ProxyにおけるI側とO側のソケットをペアに持ち、その他それに関係する情報を保持する構造体である.<br>
			ここで I側とはHTTPリクエストの発行元であり、O側とはそのリクエストをそのまま(あるいは加工して)送信する先である.<br>
			またO側からそのリクエストに対する応答(レスポンス)が返され、I側へそれをそのまま(あるいは加工して)送信する形になる.<br>
			TCPコネクション処理に関する管理やコールバックなどもここで保持する.<br>
		</div>
		<br>
		<li><b>Moai_info</b></li>
		<div class=MstyComment>
			MoaiInfo型とその寿命を管理する.<br>
			MoaiInfoとはHTTPに関する必要な情報を保持する型である.<br>
			また、MoaiInfoIDという64bit整数により、このMoaiInfo型本体へアクセスすることができるような機構を備える.<br>
			(一種の連想配列である)<br>
		</div>
		<br>
		<li><b>Moai_io_base</b></li>
		<div class=MstyComment>
			ZnkSocketのクローズやそれらに関する報告用メッセージの作成補助、<br>
			textデータのsend、パターンやサイズを加味したrecvを行う.<br>
		</div>
		<br>
		<li><b>Moai_post_vars</b></li>
		<div class=MstyComment>
			multitype/form-data形式で格納されたHTTP bodyをパースする.<br>
		</div>
		<br>
		<li><b>Moai_context</b></li>
		<div class=MstyComment>
			Moai_server内におけるscanHttpFirstから始まる一連の処理に使われる変数群を格納したもの.<br>
		</div>
		<br>
		<li><b>Moai_module</b></li>
		<div class=MstyComment>
			filterファイル(myf)やplugin(dll/so)などの管理やロード、関数の実行などを行う.<br>
		</div>
		<br>
		<li><b>Moai_post</b></li>
		<div class=MstyComment>
			POST変数やCookie変数のフィルタリングやpost_confirm用メッセージの構築などを行う.<br>
		</div>
		<br>
		<li><b>Moai_server</b></li>
		<div class=MstyComment>
			サーバ処理のコア部分であり、selectメインループが存在する.<br>
			main関数から呼ばれたMoaiServer_mainは、config.myfやmoduleのロードなどの初期化処理を終えた後、<br>
			ポート8124をリッスンし、selectメインループに入る.<br>
			<br>
			このループ内では MoaiFdSet_select において、データの入力発生(read)や接続の成功(write)、<br>
			タイムアウト(timeout)といったイベントの発生を待ち、これらのうちのいずれかが発生した場合に制御を返す.<br>
			特にデータ入力発生(read)が発生した場合においては、MoaiFdSet_process関数を介して<br>
			recv_and_sendがコールバックとして呼ばれ、入力されたデータの状態をまずscanHttpFirstで解析する.<br>
			<br>
			この解析の結果、それがHTTPリクエストの開始であるのか、あるいはその応答の開始であるのか、<br>
			あるいはそれらの途中の部分であるのかが明らかになる.<br>
			またこの解析では中継先の取得も行われ、その結果によって(非常に原始的な)Webサーバとして動作するのか<br>
			ローカルプロキシとして動作するのかの判断も行われる.<br>
		</div>
		<br>
		<li><b>Moai_log</b></li>
		<div class=MstyComment>
			ロギング処理のための関数を提供する.<br>
		</div>
		<br>
		<li><b>Moai_fdset</b></li>
		<div class=MstyComment>
			selectイベントに関するsocketの登録、観察(Observe)用.<br>
		</div>
		<br>
		<li><b>Moai_parent_proxy</b></li>
		<div class=MstyComment>
			外部プロキシ(parent_proxy)に関する処理.<br>
			外部プロキシの候補リストが記述されたparent_proxy.txtの読み込みもここで行われる.<br>
		</div>
		<br>
		<li><b>Moai_myf</b></li>
		<div class=MstyComment>
			config.myf, target.myf, analysis.myfのロードと管理.<br>
		</div>
		<br>
		<li><b>Moai_enc_util</b></li>
		<div class=MstyComment>
			URLエンコーディングおよびデコーディング.<br>
		</div>
		<br>
		<li><b>main</b></li>
		<div class=MstyComment>
			勿論mainが存在するエントリー部である.
		</div>
		<br>
	</font><br>
	<b><a class=MstyElemLink href=#Index>目次に戻る</a></b>
</ul><br>



<a name=libZnk></a>
<u><b>libZnkについて</b></u>
<ul>
	<font >
		この基本ライブラリはこのプロジェクトに存在する全てのツールの開発において使われている.<br>
		よってこれの解説を抜きにするわけにはいかないのであるが、このライブラリの仕様を詳しく解説していたら<br>
		それこそ紙面と時間がいくらあっても足らないので、とりあえず<a class=MstyElemLink href=https://github.com/mr-moai-2016/znk_project/blob/master/src/libZnk/README.md target=_blank>こちら</a>に<br>
		<b>猛烈に手抜きな</b>概要を書いておいた.<br>
		<br>
		あとはlibZnkのソースコードやコメントなどを適宜参照して戴きたい.<br>
		時間があればそのうち詳細なドキュメントも用意したいところであるが、いつになるかは未定である.<br>
	</font><br>
	<b><a class=MstyElemLink href=#Index>目次に戻る</a></b>
</ul><br>


<a name=plugin></a>
<u><b>プラグインインターフェース</b></u>
<ul>
	<font >
		Moaiプラグインでは以下のダイナミックロード可能なグローバル関数をC言語により実装する.<br>
		このバージョンにおいてサポートされる関数は以下である.<br>
		<br>
		<div class=MstyCode>
		<b>bool initiate( ZnkMyf ftr_send, const char* parent_proxy, ZnkStr result_msg );</b>
		</div>
		<div class=MstyComment>
			<br>
			target固有のsendフィルタの初期化処理を行う.<br>
			Web Configurationの「Virtual USERS Initiation」ボタンを押すとこの関数が呼び出される.<br>
			<br>
			<div class=MstyCode>
			@param ftr_send:
			</div>
			<div class=MstyComment>
				初期化対象となるフィルタへの参照である.<br>
				あなたのpluginはこの関数内でこの値を参照および変更してかまわない.<br>
				これにより、ヘッダ、ポスト変数、Cookie変数の特別な初期化(仮想化やランダマイズ化)が可能となるだろう.<br>
			</div>
			<br>
			<div class=MstyCode>
				@param parent_proxy:
			</div>
			<div class=MstyComment>
				Moaiが現在使用中の外部プロキシがhostname:portの形式で設定されている.<br>
				(外部プロキシを使用していない場合はこの値が空値であるかまたはNONEであるかまたは:0が指定されている)<br>
				あなたのpluginはこの関数内でこの値の参照は可能だが変更することはできない.<br>
			</div>
			<br>
			<div class=MstyCode>
				@param result_msg:
			</div>
			<div class=MstyComment>
				ここにはこの関数の処理をおこなった結果のメッセージを格納しなければならない.<br>
				これは処理が成功した場合はそれをリポートメッセージであり、<br>
				エラーが発生した場合はそれを示すエラーメッセージとなる.<br>
				「Virtual USERS Initiation」ボタンを押すとすぐ下にこのメッセージが表示される形になる.<br>
			</div>
		</div>
		<br>

		<div class=MstyCode>
		<b>bool on_post( ZnkMyf ftr_send, ZnkVarpAry hdr_vars, ZnkVarpAry post_vars );</b>
		</div>
		<div class=MstyComment>
			<br>
			target固有のPOST直前時の処理を行う.<br>
			POST直前に毎回呼び出される.<br>
			<br>
			<div class=MstyCode>
			@param ftr_send:
			</div>
			<div class=MstyComment>
				処理対象となるフィルタへの参照である.<br>
				あなたのpluginはこの関数内でこの値を参照および変更してかまわない.<br>
				これにより、ヘッダ、ポスト変数、Cookie変数のさらなる柔軟なフィルタリングが可能となるだろう.<br>
			</div>
			<br>
			<div class=MstyCode>
			@param hdr_vars:
			</div>
			<div class=MstyComment>
				処理対象となるリクエスト HTTP Headerの参照である.<br>
				あなたのpluginはこの関数内でこの値を参照および変更してかまわない.<br>
			</div>
			<br>
			<div class=MstyCode>
				@param post_vars:
			</div>
			<div class=MstyComment>
				処理対象となるPOST変数の参照である.<br>
				あなたのpluginはこの関数内でこの値を参照および変更してかまわない.<br>
			</div>
		</div>
		<br>

		<div class=MstyCode>
		<b>bool on_response( ZnkMyf ftr_send, ZnkVarpAry hdr_vars, ZnkStr text, const char* req_urp );</b>
		</div>
		<div class=MstyComment>
			<br>
			target固有のレスポンスを受け取った場合における処理を行う.<br>
			レスポンスを受け取った場合に毎回呼び出される.<br>
			text(これはHTML,CSS,Javascriptなどであったりする)を加工することが主な目的となるだろう.<br>
			<br>
			<div class=MstyCode>
			@param ftr_send:
			</div>
			<div class=MstyComment>
				処理対象となるフィルタへの参照である.<br>
				あなたのpluginはこの関数内でこの値を参照および変更してかまわない.<br>
			</div>
			<br>
			<div class=MstyCode>
			@param hdr_vars:
			</div>
			<div class=MstyComment>
				処理対象となるレスポンスHTTP ヘッダへの参照である.<br>
				あなたのpluginはこの関数内でこの値を参照および変更してかまわない.<br>
			</div>
			<div class=MstyCode>
			@param text:
			</div>
			<div class=MstyComment>
				処理対象となるレスポンステキストデータへの参照である.<br>
				あなたのpluginはこの関数内でこの値を参照および変更してかまわない.<br>
			</div>
			<div class=MstyCode>
			@param req_urp:
			</div>
			<div class=MstyComment>
				処理対象となるURIのpath部分(URIにおけるオーソリティより後ろの部分)が渡される.<br>
				あなたのpluginはこの関数内でこの値の参照は可能だが変更することはできない.<br>
			</div>
		</div>
		<br>

	</font><br>
	<b><a class=MstyElemLink href=#Index>目次に戻る</a></b>
</ul><br>

<a name=Znk_in_plugin></a>
<u><b>プラグインインターフェースで登場するlibZnk</b></u>
<ul>
	<font >
		上記に出現するlibZnk特有の型に関して以下に極簡単に紹介しておこう.<br>
		<br>
		<li><b>ZnkMyf</b></li>
		<div class=MstyComment>
			libZnkが提供する汎用の設定用ファイルフォーマットmyfのデータを格納するための構造体である.<br>
			全フィールドは隠蔽されており、それらに対する操作はすべて関数を通じて行う.<br>
			インターフェースはZnk_myf.h によって提供され、Znk_myf.cがその実装部である.<br>
		</div>
		<br>
		<li><b>ZnkStr</b></li>
		<div class=MstyComment>
			libZnkが提供する動的拡張可能な汎用文字列型を実現するための構造体である.<br>
			全フィールドは隠蔽されており、それらに対する操作はすべて関数を通じて行う.<br>
			インターフェースはZnk_str.h によって提供され、Znk_str.cがその実装部である.<br>
			(実装にあたってはZnkBfr(Znk_bfr.h)というさらに基本的な汎用バイト列型を利用している)<br>
		</div>
		<br>
		<li><b>ZnkPrim</b></li>
		<div class=MstyComment>
			以下を格納可能なコンテナというか汎用型である.<br>
			<br>
			<ul>
				<li>整数</li>
				<li>実数</li>
				<li>ポインタ</li>
				<li>バイト列データZnkBfr</li>
				<li>ZnkBfrの配列</li>
				<li>文字列ZnkStr</li>
				<li>ZnkStrの配列</li>
				<li>ZnkPrimそのものの配列</li>
			</ul>
			<br>
			フィールドは公開されているが、異コンパイラ間でのポータビリティに配慮すべく<br>
			アラインメントに関して可能な限りの配慮がなされている.<br>
			<br>
			以下のような形で使用する.<br>
			<div class=MstyComment>
				<div class=MstyCode>
					ZnkPrim prim;<br>
					ZnkPrimType type;<br>
					ZnkPrim_compose( &amp;prim, ZnkPrim_e_Real ); /* 初期化 */<br>
					<br>
					type = ZnkPrim_type( &amp;prim ); /* 内部にどのタイプの値が入っているかを取得 */<br>
					if( type == ZnkPrim_e_Real ){<br>
					&nbsp;&nbsp;prim.r64_ = 0.123; /* 内部が実数型なら実数をセットするなど */<br>
					}<br>
					<br>
					ZnkPrim_dispose( &amp;prim ); /* 破棄 */<br>
				</div>
			</div>
			<br>
			インターフェースはZnk_prim.h によって提供される.<br>
		</div>
		<br>
		<li><b>ZnkVarp</b></li>
		<div class=MstyComment>
			ZnkPrimに加え、nameとfilenameをそのフィールドに持つ.<br>
			いわゆる「変数」のような構造を実現した型である.<br>
			すなわちnameが変数名であり、ZnkPrimがその値となる.<br>
			主な関数を一部紹介しよう.<br>
			これらのインターフェースはZnk_var.h によって提供され、Znk_var.cがその実装部である.<br>
			<br>
			<ul>
				<li><b>ZnkVar_compose</b></li>
				<div class=MstyComment>
					初期化を行う.
				</div>
				<br>
				<li><b>ZnkVar_dispose</b></li>
				<div class=MstyComment>
					破棄を行う.
				</div>
				<br>
				<li><b>const char* ZnkVar_name_cstr( const ZnkVar* var )</b></li>
				<div class=MstyComment>
					変数varの名前をC文字列として取得する.
				</div>
				<br>
				<li><b>ZnkVar_set_val_Str( ZnkVar* var, const char* data, size_t data_size )</b></li>
				<div class=MstyComment>
					varを文字列型変数として文字列dataで値をセットする.
				</div>
				<br>
				<li><b>const char* ZnkVar_cstr( ZnkVar* var )</b></li>
				<div class=MstyComment>
					var が文字列型変数の場合に限り使用できる簡易関数で、その値をC文字列として取得できる.<br>
				</div>
			</ul>
		</div>
		<br>
		<li><b>ZnkVarpAry</b></li>
		<div class=MstyComment>
			ZnkVarpの動的拡張可能な配列である.<br>
			HTTPヘッダ全体、POST変数群、Cooking変数群などは要するにすべて(値が文字列型である)<br>
			変数の配列であって、いずれもこの型で実現できる.<br>
			インターフェースはZnk_varp_ary.h によって提供され、Znk_varp_ary.cがその実装部である.<br>
			(実装にあたってはZnkObjAry(Znk_obj_ary.h)というさらに基本的なポインタ型汎用配列を利用している)<br>
		</div>
		<br>

	</font><br>
	<b><a class=MstyElemLink href=#Index>目次に戻る</a></b>
</ul><br>

<u><b>リンク</b></u>
<ul>
	<li><a class=MstyElemLink href="#TopBar">一番上へ</a></li>
	<li><a class=MstyElemLink href="https://mr-moai-2016.github.io">Moaiドキュメント(オンライン)</a></li>
	<li><a class=MstyElemLink href="https://github.com/mr-moai-2016/znk_project">znk_project(github)</a></li>
</ul>

</body>
</html>
