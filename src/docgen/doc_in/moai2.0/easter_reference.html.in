@def_quote [' ']

##
# doc_title:
#   この記事のタイトル.
#
# author:
#   記事担当者.
#
# update:
#   最終更新日.
#
# category_path:
#   ガイドメニューにおけるカテゴリを示す.
#
# urp:
#   ガイドメニューのリンク先.
#
# nb_tags:
#   ここで指定した tag が行末に現れた場合は <br> の自動付加を行わない.
#
# title_attr_fmt:
#   各Sectionのタイトルの部分に続けて付加的な文字列を挿入することができる.
#   これをTitle Attributeと呼び、ここではそのformat文字列を指定する.
#   またこのformat文字列に %s を一つ含めることにより、Indexセクションの第3カラム要素をそこに挿入させることができる.
#
# 行末における<\>:
#   これが行末に指定されている場合は <br> の自動付加を行わない.
# 
#
@@V config
doc_title = ['Moai+Easter ユーザーマニュアル']
author = ['全角']
update = ['2018/05/23']
category_path = { ['moai2_0_user'] ['easter'] }
urp           = ['/moai2.0/easter_reference.html']
nb_tags = { ['div'] ['ul'] ['ol'] ['li'] }
@@.

@@L AtFirst
	Easterは仮想ブラウザ環境(以降、単に仮想環境と呼ぶ)を利用するツールです.
	これはMoai CGI上でWebアプリケーションとして動作します.
	ここではEasterに関する全機能を詳細に解説します.
@@.

@@P Index
{ ['#FirstEaster']            ['初めてのEaster'] }
{ ['#EasterLinkManager']      ['Easter リンクマネージャー'] }
{ ['#EasterURL']              ['Easter URL'] }
{ ['#EasterURL_Mechanism']    ['仮想環境が継続的に維持される仕組み'] }
{ ['#EasterBBSOperation']     ['Easter BBS Operation'] }
{ ['#EasterHyperPost']        ['Easter HyperPost'] }
{ ['#CooperateOthersViewers'] ['その他の専ブラとの連携動作について'] }
@@.


@@L FirstEaster
	Easterを使うために必要なことは、以下の二つだけです.
	<ol>
		<li>moai(Windowsならmoai.exe)を起動する.
		</li>
		
		<li>ブラウザから http://localhost:8124 を開く.

		<div class=MstyComment>
			これでうまくいかない場合は http://127.0.0.1:8124 で試してみましょう.
		</div>
		</li>
	</ol>
	お使いのブラウザに以下のような「Welcome to Moai+Easter World」のページが表示されたでしょうか？
	
	<div class=MstyComment>
		<img src=/imgs/moai_top_page.png width=100%>
	</div>
	
	表示されたなら、そこから<a class=MstyAppLink href="http://127.0.0.1:8124/easter" target=_blank>Easter</a>をクリックします.
	以下のような画面が表示されると思います.
	
	<div class=MstyComment>
		<img src=/imgs/easter_link_manager1.png width=100%>
	</div>
	
	各リンクの先頭にある「Open」をクリックすると、そのリンク先のサイトを仮想環境で閲覧します.
	
	しかしその前に！
	もし今回が新しくMoaiをダウンロードした直後、初めてのMoai起動ならば、
	まず<a class=MstyElemLink href=/moai2.0/virtual_users.html>VirtualUSERS</a>より、仮想環境をあなた用に変更しておいた方がよいでしょう.
@@.


@@L EasterLinkManager
	ここではEasterの仮想環境を開始するためのいくつかのリンクを登録しておくことができます.
	デフォルトでもいくつか登録されていますが、ユーザが自由に登録追加、削除できます.
	またその内容を編集したり修正することができます.
	いわゆるブックマークのような使い方も可能です.
	
	これらの登録情報の実体は、moai_profileディレクトリ配下にある link_list.myf ファイルに保存されます.
	Moai/Easterでは、設定情報等を保存するのに外部サーバマシンやデータベース、レジストリなどは使用していません.
	
	Easterの仮想環境が現在サポートしているのは５ちゃんねるとふたばちゃんねるのみとなります.
	サポート対象のサイトのURLを登録すれば、そのリンク先を開くことで仮想状態が機能します.
	一方、サポート対象以外のサイトのURLであっても一応登録できます.
	この場合「Open」で開かれる先が通常のURLになっていることからもお分かりかと思いますが、
	リンク先をEasterを介さず直接閲覧することになりますので、仮想状態も機能しません.
	この場合は、本当に単なるブックマークとしての使い方になります.
	登録したリンクには <img src=/imgs/others_16.png> のようなマークがつきます.
	
	<b>リンクの登録/編集</b>
	
	<div class=MstyIndent>
		新しいリンクを登録するには以下の手順を行って下さい.
		<ol>
			<li>「リンクの新規登録」ボタンを押し、「Linkの新規登録」用のUIを表示させます.</li>
			
			<li>「URL」入力フィールド欄に登録したいサイトのURLをそのままコピペします.
			(これは通常のURL、あるいはEasterで開いたときのURL(Easter URL)でもどちらでもかまいません).</li>
			
			<li>必要であれば「説明」入力フィールド欄に登録したURLについての説明を入力します.
			これが登録後「仮想環境のスタート」に表示される文字列となります.
			(ここに何も入力しなかった場合はURLが表示されます).</li>
			
			<li>「上記で登録」ボタンを押します.
			これにより上の「仮想環境のスタート」に今入力したものが一つ追加されます.</li>
		</ol>
		
		既に登録したリンクの内容を修正するには以下の手順を行ってください.
		<ol>
			<li>LinkManagerにおける「仮想環境のスタート」に列挙されているリンクのうち、
			修正したいものに一つチェックを入れます.
			(もし複数チェックを入れた場合は、一番上のものが選択されたとみなされます).</li>
			
			<li>「選択したリンクを編集」ボタンを押します.
			選択したリンクの現在の内容が入力フィールドに表示されますのでこれを新しい内容に書き換えます.</li>
			
			<li>「上記で登録」ボタンを押します.
			これにより上の「仮想環境のスタート」に修正が反映されます.</li>
		</ol>
	</div>
	
	<b>リンクの並び替え</b>
	
	<div class=MstyIndent>
		「チェックしたリンクを一番上へ」ボタンを押すと、
		「仮想環境のスタート」でチェックを入れた項目が並びとして一番上へ移動します.
		このボタンだけでも一応任意の並び替えはできます.
	
		リンクにはサイト毎にカテゴリが設定されています.
		これはURLのホスト名よりEasterが自動判断します.
		例えば *.2chan.net ならカテゴリは「ふたばちゃんねる」であるといった具合です.
		現在Easterが用意しているサイト毎のカテゴリは「ふたばちゃんねる」、「５ちゃんねる」、「その他」の３つがあります.
	
		「カテゴリ毎に集める」ボタンを使うとリンクを簡単にカテゴリ毎に揃えることができます.
		たとえば「５ちゃんねる」のカテゴリに属するリンクをすべて一番上方へと移動して揃えたいとしましょう.
		以下の手順になります.
		<ol>
			<li>「仮想環境のスタート」に列挙されているリンクのうち、
			カテゴリが「５ちゃんねる」であるものに一つチェックを入れます.
			(５ちゃんねるのリンクのうち、一番上にある一つを選ぶと良いでしょう).</li>
			
			<li>「選択したリンクを一番上へ」ボタンを押します.
			これにより、今チェックを入れたリンクが一番上方へと移動します.</li>
			
			<li>「カテゴリを集める」ボタンを押します.
			これにより、残りの全ての５ちゃんねるのリンクが一括して一番上方へと集められます.</li>
		</ol>
		実のところ、これはこのボタンの正確な仕様を記載したものではなく、
		一番上以外のカテゴリのリンクも出現順に集められるのですが、
		分かりにくくなるためその説明は割愛します.
		それは説明するより実際に色々並び替えを試してもらった方が状況を掴みやすいかもしれません.
	</div>
	
	<b>リンクの削除</b>
	
	<div class=MstyIndent>
		不要なリンクを削除するには以下の手順を行ってください.
		<ol>
			<li>「仮想環境のスタート」に列挙されているリンクのうち、
			削除したいものにチェックを入れます.</li>
			
			<li>「選択したリンクを削除」ボタンを押します.
			これにより上の「仮想環境のスタート」にチェックを入れたもののみが削除されます.</li>
		</ol>
	</div>
@@.


@@L EasterURL
	以下の例でEaster URLの構造を簡単に説明しましょう.
	
	<div class=MstyComment>
		http://192.168.0.1:8125/easter?est_view=may.2chan.net/b/futaba.php?mode=cat&amp;sort=1
	</div>

	<ul>
		<li><b>192.168.0.1:8125</b>
		あなたのマシンで今起動しているMoaiへの接続を意味します.
		ここでのIPとポート番号はMoaiがセキュリティーの観点から厳格に規定したものが使われます.
		(これをMoai XhrDMZと呼びます. XhrDMZでは通常、IPは127.0.0.1またはLAN上でのものが採用されます.
		またポート番号はこの場合に限り8124ではなく8125になります.)
		</li>
		
		<li><b>easter</b>
		EasterをMoai CGIとして起動することをMoaiエンジンに指示します.
		</li>
		
		<li><b>est_view=</b>
		これに続けて目的のサイトのURLを与えます.
		Easterが現在サポートしているサイトのURLならば、基本的にはどのページのものでも構いません.
		(現在サポートされているサイトは５ちゃんねるとふたばちゃんねるのみです)
		</li>
	</ul>
@@.


@@L EasterURL_Mechanism
	EasterはデフォルトでいくつかのサイトへのEaster URLが登録されていますが、
	ここに登録するリンクはサイトのトップ等にある<b>目次に相当するページ</b>だけで十分です.
	(これらは掲示板などでは「板一覧メニュー」や「カタログ」と呼ばれることもあります)
	
	しかし目次に相当するページはスレッド本体や書き込みをする画面とは違います.
	後者の画面においては仮想環境が機能しないのでは？と思われる方もおられるかもしれません.
	
	大丈夫です. 
	目次からさらに先のリンクへと移動した場合でもEaster URLがうまく継続するようになっています.
	Easter URLさえ維持されていれば仮想状態もまた維持するのです.
	
	何が起きているのか詳しく説明しましょう.
	通常、Easterで閲覧したページ内に子となるページへのリンクが含まれていた場合、
	そのリンク先もEasterを介する閲覧となるようにEaster URLへの変換が自動的に行われます. 
	さらにその子を閲覧したタイミングで、同様の変換がその孫へのリンクに対しても行われ、
	この連鎖によりEasterによる仮想状態を子孫へ継続させる仕組みとなっています.
	
	一方、Easterが認識できないサイトへのリンク(喩えるなら家族や親戚以外へのリンク)が含まれていた場合、
	このリンクに対してはEaster URLへ変換は行われず、従ってその先はEasterを介さず直接閲覧する形になります.
@@.


@@L EasterBBSOperation
	Easter BBS Operationとは、Easterの仮想環境で掲示板(BBS)を閲覧しているときに、
	スレッドの最下部に以下のように表示されるもので、Easterが提供する掲示板(BBS)用の操作パネルです.
	
	<div class=MstyComment>
		例. ふたばちゃんねる用 Easter BBS Operation
		<img src="/imgs/easter_bbs_operation_futaba.png" width=100%>
	</div>

	<div class=MstyComment>
		例. 5ちゃんねる用 Easter BBS Operation
		<img src="/imgs/easter_bbs_operation_5ch.png" width=100%>
	</div>
	
	この操作パネルでは、現在閲覧中のスレッドに関して次のような操作が行えます.
	これらのうちリロード以外の操作については、まず「詳細モード」を押して専用の画面を出してから行います.
	<ul>
		<li><b>リロード</b>
		このスレッドを再読み込みして最新の内容を表示します.
		</li>
		
		<li><b>このHTMLをお気に入りへ</b>
		このスレッドのHTMLを「お気に入りボックス」へと登録します.
		登録されたHTMLは永久保存され、自動的には削除されなくなります.
		「お気に入りボックス」についての詳細は<a class=MstyElemLink href=/moai2.0/easter_collection.html#TopicViewer target=_blank>こちら</a>を参照してください.
		</li>
		
		<li><b>このHTMLをストック</b>
		このスレッドのHTMLをストックボックスへ登録します.
		登録されたHTMLは永久保存され、自動的には削除されなくなります.
		「ストックボックス」についての詳細は<a class=MstyElemLink href=/moai2.0/easter_collection.html#TopicViewer target=_blank>こちら</a>を参照してください.
		</li>
		
		<li><b>最近処理したものとして扱う</b>
		このスレッドを「最近処理したもの」として扱います.
		「最近処理したもの」とは分類等の処理をした最近の画像やHTMLへのリンクを自動的に保持する特殊なリストで、
		これはEasterコレクションから参照することができます.
		
		非常に保持期間の短いブックマークのようなものとして使うこともできます.
		一方、このコマンドではストックやお気に入りへの登録は行われません.
		従って、規定の日数が経過するとキャッシュおよびこのリストからも削除されます.

		<div class=MstyComment>
			この「最近処理したもの」のリストは、Easterの内部実装ではRecentoryと呼ばれます.
			これは「Recent」と「Directory」を合わせた完全な造語です.
			このリストの実体はrecentory.myfファイルとなります.
		</div>
		</li>
		
		<li><b>サムネ保存</b>
		このスレッドのすべてのサムネイル画像までもキャッシュに保存させます.
		これにより、このスレッドがネットBBS上で寿命で消えても、サムネイル画像を含めたHTMLとしてしばらくは見ることができます.
		</li>
		
		<li><b>キャッシュから即削除</b>
		このスレッドをキャッシュから即削除します.
		通常、放っておいてもキャッシュは古いものから順に削除されていきますが、
		明らかに保持しておく必要のないスレッドならここで直ちに削除しておいてもよいでしょう.
		あるいはなんかの通信エラー等により現在保持されているキャッシュの内容が壊れている場合に
		一旦キャッシュを消して再読み込みすることでHTMLの再ダウンロードを促すこともできます.
		</li>
		
		<li><b>キャッシュをBoxMapビューアで開く</b>
		このスレッドのキャッシュが保存されている実ディレクトリをBoxMapビューアより閲覧します.
		</li>
		
		<li><b>オリジナルURLでダイレクトに開く</b>
		このスレッドを敢えてEasterを介さず直接開いて閲覧します.
		開いた先ではEasterの仮想環境や広告カットなどのフィルタリングなどが一切機能していませんので注意してください.
		</li>
	</ul>
@@.


@@L EasterHyperPost
	Easter HyperPostとは、Easterの仮想環境で掲示板(BBS)を閲覧において、
	通常の投稿(Post)よりさらに強力な投稿(HyperPost)を提供するものです.
	
	ここでは画像掲示板「ふたばちゃんねる」を例に挙げましょう.
	以下はふたばちゃんねるの標準の投稿フォームです.
	
	<div class=MstyComment>
		例. ふたばちゃんねるの標準の投稿画面
		<img src="/imgs/easter_hyper_post_for_futaba_entry.png" width=100%>
	</div>
	
	この通常のフォームからの場合でもEasterの仮想環境は機能しますので一向に構わないのですが、
	「Easter HyperPostで返信する」というボタンを押すことで、さらに以下のようなEaster HyperPostの投稿フォームの画面となります.
	
	<div class=MstyComment>
		例. ふたばちゃんねる用 Easter HyperPost
		<img src="/imgs/easter_hyper_post_for_futaba.png" width=100%>
	</div>
	
	通常の投稿フォームと似ている部分もありますし、いくつか追加された入力フィールドも見られます.
	何が違うのでしょうか？
	以下に列挙します.
	<ul>
		<li><b>添付URL機能</b>
		Easter HyperPostの一番の目玉機能となります.
		
		通常の投稿フォームの場合、画像を投稿するには「参照」ボタンを押してファイル選択ダイアログを開き、
		そこからローカルディスクのフォルダの中にある画像を選ぶという手順を踏みます.
		つまりネット上にある画像をそのまま投稿したい場合は、あらかじめあなたのマシンの適当なフォルダに
		それをダウンロードしておかなければなりません.
		
		一方、Easter HyperPostでは、「添付URL」欄にネット上にある画像のURLをダイレクトに指定することができます.
		URLをこの欄にコピペして「返信する」ボタンを押すだけで直ちにその画像を投稿することができるわけです.

		<div class=MstyComment>
			指定するURLはEasterコレクション上の画像のURLでも構いません.
			これについては詳しくは<a class=MstyElemLink href=/moai2.0/easter_collection.html#HyperPost target=_blank>こちら</a>を参照してください.
			これはいわばEasterコレクションとEaster HyperPostの両方の機能をフルに活用した奥義的な使い方です.
			あなたが画像BBSから収集した画像コレクションと、それを再び画像BBSに投稿するという一連の流れを
			ブラウザ内のみで完結させることができます.
		</div>
		</li>
		
		<li><b>イメぐぐる機能</b>
		この機能は「添付URL」機能とセットで使うと良いでしょう.
		つまりまず「イメぐぐる」欄にキーワード文字列を入力して「Google画像検索を開く」を押します.
		するとそのキーワードでGoogle画像検索された結果の画面がブラウザの別タブで表示されますので、
		そこから好みの画像を見つけてその画像のURLを「添付URL」にコピペするといった使い方を想定しています.
		</li>
		
		<li><b>仮想環境の確認</b>
		Easter HyperPostの画面では、今から投稿した場合に送られるHTTPヘッダの内容と、
		Post変数群の全内容が表示されます.
		これは具体的な返信内容や画像などの添付ファイルの本体を除けば、
		これから掲示板(BBS)に送信される情報の枠組みの全てとなります.
		このあたりの知識がある方は参考にしてください.
		Easterによって仮想化された送信情報のすべての内容を確認できると思います.
		</li>
	</ul>
@@.


@@L CooperateOthersViewers
	このセクションでは Easter とその他の専ブラを同時に使う方向けに、
	その方法について説明します.
	<ul>
		<li><b>ふたばちゃんねる:赤福</b>
		
		赤福の設定で「外部の板」パネルを開き、「外部の板でも動作させる」にチェックを入れます.
		「パターン」に以下をコピペし、「追加」ボタンを押します.
		
		<div class=MstyComment>
			^http://.+:8125/easter\?est_.*=(.*)\.2chan\.net/([^/]+)/([^#]*)
		</div>

		「monaca.php」と「前方一致」のチェックは<b>Off</b>にしておきます.
		下部にある「適用」ボタンを押して、赤福の設定ウィンドウを閉じます.
		これでEasterで閲覧中も赤福の機能が有効になります.
		(ただし一部の赤福の機能は動作しないかもしれません).
		
		<div class=MstyComment>
			Easter用の赤福設定ウィンドウ画面
			<img src="/imgs/easter_akahuku_config.png" width=100%>
		</div>
		</li>
		
		<li><b>ふたばちゃんねる:ふたクロ</b>
		
		ChromeのExtentions内にあるふたクロのソース(viewer.js等)を拝見させて頂いた限りでは、
		ふたクロが認識するURLは *.2chan.net というサーバ名で固定となっているようです.
		つまり赤福とは異なり、ふたクロではふたばちゃんねる以外の(ふたばライクなサーバの)URLを
		認識させる手段がユーザ側では用意されていないということです.
		そのため、ふたクロとEasterを<b>同時に</b>使用することは現状できません.
		
		<div class=MstyComment>
			ふたクロをインストールしている状態でもEaster自体は支障なく使えるのですが、
			Easterで閲覧中はふたクロの機能の方が発動されていない状態になります.
			一方、Easterを使わずに通常のURLでふたばにアクセスした場合はふたクロが発動します.
		</div>

		ではふたクロを使いつつMoaiのフィルタ機能の恩恵をも享受するにはどうしたらよいでしょうか？
		一つの答えとして、Moaiをローカルプロキシとして使う方法があります.
		即ちChrome側でローカルプロキシとして、アドレスを127.0.0.1、ポートを8124に設定します.
		これならば通常のURLでふたばにアクセスしてもMoaiのフィルタ機能が働き、
		またふたクロをも発動させることができます.
		
		<div class=MstyComment>
			…と、まあここまで設定しなくとも、Easterとふたクロの一方だけならどちらも支障なく動作するのですから、
			閲覧専用(ROM)時はふたクロを使って通常のURLでアクセスし、
			書き込みが必要になった時だけEasterを使うという割り切った使い方でも意外と良い気もします.
		</div>
		</li>
	</ul>
@@.

@@P Link
{ ['#TopBar'] ['一番上へ'] }
{ ['https://mr-moai-2016.github.io'] ['Moaiドキュメント(オンライン)'] }
{ ['https://github.com/mr-moai-2016/znk_project'] ['znk_project(github)'] }
@@.
